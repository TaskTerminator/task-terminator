'use strict';

var mongoose = require('mongoose');
var Position = require('../models/Position.js');
var Company = require('../models/Company.js');
var Department = require('../models/Department.js');
var Employee = require('../models/Employee.js');
var Project = require('../models/Project.js');
var ProjectTask = require('../models/ProjectTask.js');
var Q = require('q');
var moment = require('moment');
var helpers = require('../controllers/projectHelpers');
var projectCtrl = require('../controllers/projectCtrl');

module.exports = {

  /************** ARRAYS **************/

  arrayMaker: function arrayMaker(array) {
    var deferred = Q.defer();
    console.log("I'm trying to make an array!");
    var madeArray = [];
    for (var i = 0; i < array.length; i++) {
      console.log("Here's the name I'm looking at....", array[i].name);
      madeArray.push(array[i].name);
    }
    console.log("Here's the full array I made and am trying to return", madeArray);
    deferred.resolve(madeArray);
    console.log("This is the deferred promise", deferred.promise);
    return deferred.promise;
  },

  arrayMakerEmployeeName: function arrayMakerEmployeeName(array) {
    var deferred = Q.defer();
    console.log("I'm trying to make an array!", array);
    var madeArray = [];
    for (var i = 0; i < array.length; i++) {
      console.log("Here's the name I'm looking at....", array[i].identification.name.fullName);
      madeArray.push(array[i].identification.name.fullName);
    }
    console.log("Here's the full array I made and am trying to return", madeArray);
    deferred.resolve(madeArray);
    console.log("This is the deferred promise", deferred.promise);
    return deferred.promise;
  },

  /************** ATTACHMENTS **************/

  attachmentMaker: function attachmentMaker(array, attachmentTitle) {
    console.log("Here's the array to be turned into an attachement", array, attachmentTitle);
    var deferred = Q.defer();
    console.log("I'm trying to make a nice attachment for you....");
    var attachment = {
      title: attachmentTitle,
      color: '#7FEFBD',
      fields: []
    };

    for (var j = 0; j < array.length; j++) {
      attachment.fields.push({
        label: 'Field',
        value: array[j],
        short: true
      });
    }
    console.log(attachment);
    deferred.resolve(attachment);
    return deferred.promise;
  },

  helpAttachment: function helpAttachment(array, attachmentTitle) {
    console.log("Here's the array to be turned into an attachement", array, attachmentTitle);
    var deferred = Q.defer();
    console.log("I'm trying to make a nice attachment for you....");
    var attachment = {
      title: attachmentTitle,
      color: '#7FEFBD',
      fields: [{
        label: 'Field',
        title: ' ',
        value: "Hi.\n I didn't understand what you want. \nBut don't worry... I'm here to help. \nBefore you panic check out this list of commands to get the info you need. Because I'm artifically intelligent, if you type anything close to the commands below I'll probably give you what your looking for. If not, just type the closest command exactly. Over time I'll get better and better at understanding your intent, so get to work!\n",
        short: false
      }, {
        label: 'Field',
        value: ' ',
        short: true
      }, {
        label: 'Field',
        value: ' ',
        short: true
      }, {
        label: 'Field',
        value: '*Command*',
        short: true
      }, {
        label: 'Field',
        value: '*Description*',
        short: true
      }],
      mrkdwn_in: ['fields']
    };

    for (var j = 0; j < array.length; j++) {
      attachment.fields.push({
        label: 'Field',
        value: array[j],
        short: true
      });
    }
    console.log(attachment);
    deferred.resolve(attachment);
    return deferred.promise;
  },

  projectsAttachment: function projectsAttachment(array, attachmentTitle) {
    console.log("Here's the array to be turned into an attachment", array, attachmentTitle);
    var deferred = Q.defer();
    console.log("I'm trying to make a nice attachment for you....");
    var attachment = {
      title: attachmentTitle,
      color: '#7FEFBD',
      fields: [],
      mrkdwn_in: ['fields']
    };

    for (var j = 0; j < array.length; j++) {
      attachment.fields.push({
        label: 'Field',
        value: "_#" + array[j].friendlyId + "_: *" + array[j].name + "* - " + array[j].description + " - *Due : *" + moment(array[j].setup.dueDate.actual).format('dddd, MMMM Do') + " - *Status: *" + array[j].status,
        short: false
      });
    }
    deferred.resolve(attachment);
    return deferred.promise;
  },

  taskAttachment: function taskAttachment(array, attachmentTitle) {
    console.log("Here's the array to be turned into an attachment", array, attachmentTitle);
    var deferred = Q.defer();
    console.log("I'm trying to make a nice attachment for you....");
    var attachment = {
      title: attachmentTitle,
      color: '#7FEFBD',
      fields: [],
      mrkdwn_in: ['fields']
    };

    for (var j = 0; j < array.length; j++) {
      attachment.fields.push({
        label: 'Field',
        value: "_#" + array[j].friendlyId + "_: *" + array[j].name + " - *Status: *" + array[j].status,
        short: false
      });
    }
    deferred.resolve(attachment);
    return deferred.promise;
  },

  /************** FORMATTING **************/

  hashStripper: function hashStripper(id) {
    console.log("Here's the id I'm trying to fix", id);
    var deferred = Q.defer();
    if (id.charAt(0) !== "#") {
      deferred.resolve(id);
      return deferred.promise;
    } else {
      var cleanId = id.split('#');
      deferred.resolve(cleanId[1]);
      return deferred.promise;
    }
  },

  /************** QUERIES - DEPARTMENTS  **************/
  allDepartments: function allDepartments(req, res) {
    var deferred = Q.defer();
    Department.find().exec().then(function (departments) {
      deferred.resolve(departments);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },

  /************** QUERIES - EMPLOYEES  **************/
  allEmployees: function allEmployees(req, res) {
    var deferred = Q.defer();
    Employee.find().exec().then(function (employees) {
      deferred.resolve(employees);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },

  /************** QUERIES - POSITIONS  **************/
  allPositions: function allPositions(req, res) {
    var deferred = Q.defer();
    Position.find().exec().then(function (positions) {
      deferred.resolve(positions);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },

  /************** QUERIES - PROJECTS  **************/
  allProjects: function allProjects(req, res) {
    var deferred = Q.defer();
    Project.find().exec().then(function (projects) {
      console.log("Here's the projects I found...", projects);
      deferred.resolve(projects);
    }).catch(function (err) {
      return res.status(500).end();
    });
    console.log(deferred.promise);
    return deferred.promise;
  },

  allIncompleteProjects: function allIncompleteProjects(req, res) {
    var deferred = Q.defer();
    Project.find().exec().then(function (projects) {
      console.log("Here's the incomplete projects I found...", projects);
      var incompleteProjects = [];
      projects.map(function (item) {
        console.log("ITEM", item);
        if (item.status === 'Incomplete') {
          console.log('INCOMPLETE PROJECTS', item);
          incompleteProjects.push(item);
        }
      });
      deferred.resolve(incompleteProjects);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },

  allCompleteProjects: function allCompleteProjects(req, res) {
    var deferred = Q.defer();
    Project.find().exec().then(function (projects) {
      console.log("Here's the Complete projects I found...", projects);
      var completeProjects = [];
      projects.map(function (item) {
        console.log("ITEM", item);
        if (item.status === 'Complete') {
          console.log('COMPLETE PROJECTS', item);
          completeProjects.push(item);
        }
      });
      deferred.resolve(completeProjects);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },

  /************** QUERIES - PROJECT TASKS  **************/
  allProjectTasks: function allProjectTasks(req, res) {
    console.log("Made it to all project tasks!");
    var deferred = Q.defer();
    ProjectTask.find().exec().then(function (results) {
      console.log("This is what I found for all the tasks", results);
      deferred.resolve(results);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },

  allIncompleteTasks: function allIncompleteTasks(req, res) {
    console.log("Made it to all incomplete tasks!");
    var deferred = Q.defer();
    ProjectTask.find().exec().then(function (results) {
      var incompleteTasks = [];
      results.map(function (item) {
        console.log("TASK", item);
        if (item.status === 'Incomplete') {
          incompleteTasks.push(item);
        }
      });
      deferred.resolve(incompleteTasks);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },

  tasksInProject: function tasksInProject(id) {
    console.log("Here's the id I'm looking for", id);
    var deferred = Q.defer();
    Project.find({ "friendlyId": id }).populate('tasks').exec().then(function (result) {
      console.log("did i find a project?", result);
      deferred.resolve(result);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },

  taskComplete: function taskComplete(id) {
    console.log("Here's the id I'm looking for", id);
    var deferred = Q.defer();
    ProjectTask.findOneAndUpdate({ "friendlyId": id }, { status: 'Complete' }, { new: true }).exec().then(function (newTask) {
      console.log("RESULT", newTask);
      deferred.resolve(newTask);
    });
    return deferred.promise;
  },
  statusCheck: function statusCheck(id) {
    console.log("ID", id);
    var deferred = Q.defer();
    ProjectTask.find({ "friendlyId": id }).exec().then(function (task) {
      console.log('TASK', task);
      if (task[0].status === 'Complete') {
        deferred.resolve(false);
      } else {
        deferred.resolve(task);
      }
    }).catch(function (err) {
      console.log(err);
    });
    return deferred.promise;
  },
  taskCompleteCount: function taskCompleteCount(projectId) {
    var deferred = Q.defer();
    var oldProject;
    Project.find({ '_id': projectId }).exec().then(function (project) {
      project[0].tasksCompleted++;
      console.log("# TASKS COMPLETED", project[0].tasksCompleted);
      if (project[0].tasksCompleted === project[0].tasks.length) {
        project[0].status = 'Complete';
        console.log("IS PROJECT COMPLETE?", project[0].status);
      }
      console.log('IS THIS A PROMISE?', project[0].save());
      return project[0].save();
    }).then(function (project) {
      if (project.status === 'Complete') {
        return projectCtrl.newProject(project.setup.associatedTemplate);
      } else {
        return;
      }
    }).then(function (newProject) {
      console.log('DID IT WORK?', newProject);
    });
  },

  /************** QUERIES - DUE DATES  **************/

  overdueProjects: function overdueProjects(req, res) {
    console.log("Made it to overdue projects!");
    var deferred = Q.defer();
    Project.find().exec().then(function (projects) {
      console.log('PROJECTS', projects);
      var overdue = [];
      projects.map(function (item) {
        console.log('ITEM1', item.setup.dueDate.actual);
        console.log('ITEM2', moment());
        console.log('TRUE OR FALSE', moment().isAfter(moment(item.setup.dueDate.actual)));
        if (moment().isAfter(moment(item.setup.dueDate.actual))) {
          if (item.status === 'Incomplete') {
            console.log('ITEM3', item);
            overdue.push(item);
          }
        }
      });
      deferred.resolve(overdue);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },
  overdueTasks: function overdueTasks(req, res) {
    console.log("Made it to overdue tasks!");
    var deferred = Q.defer();
    ProjectTask.find().exec().then(function (tasks) {
      console.log('TASKS', tasks);
      var overdue = [];
      tasks.map(function (item) {
        console.log('ITEM1', moment(item.date.deadline));
        console.log('ITEM2', moment());
        console.log('TRUE OR FALSE', moment().isAfter(moment(item.date.deadline)));
        if (moment().isAfter(moment(item.date.deadline))) {
          console.log('ITEM3', item);
          overdue.push(item);
        }
      });
      deferred.resolve(overdue);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },
  projectsDueThisWeek: function projectsDueThisWeek(req, res) {
    console.log("Made it to projectsDueThisWeek");
    var deferred = Q.defer();
    Project.find().exec().then(function (projects) {
      console.log('PROJECTS', projects);
      var week = [];
      projects.map(function (item) {
        console.log("WEEK", moment(item.setup.dueDate.actual).week());
        console.log("CURRENT WEEK", moment().week());
        if (moment().week() === moment(item.setup.dueDate.actual).week()) {
          console.log('ITEM', item);
          week.push(item);
        }
      });
      deferred.resolve(week);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },
  projectsDueThisMonth: function projectsDueThisMonth(req, res) {
    console.log("Made it to projectsDueThisMonth");
    var deferred = Q.defer();
    Project.find().exec().then(function (projects) {
      console.log('PROJECTS', projects);
      var month = [];
      projects.map(function (item) {
        console.log("MONTH", moment(item.setup.dueDate.actual).month());
        console.log("CURRENT MONTH", moment().month());
        if (moment().month() === moment(item.setup.dueDate.actual).month()) {
          console.log('ITEM', item);
          month.push(item);
        }
      });
      deferred.resolve(month);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },
  projectsDueToday: function projectsDueToday(req, res) {
    console.log("Made it to projectsDueToday");
    var deferred = Q.defer();
    Project.find().exec().then(function (projects) {
      console.log('PROJECTS', projects);
      var today = [];
      projects.map(function (item) {
        console.log("DUE DATE", moment(item.setup.dueDate.actual).dayOfYear());
        console.log("TODAY", moment().dayOfYear());
        if (moment(item.setup.dueDate.actual).dayOfYear() === moment().dayOfYear()) {
          console.log('ITEM', item);
          today.push(item);
        }
      });
      console.log("ARRAY", today);
      deferred.resolve(today);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZlcl9hc3NldHMvY29udHJvbGxlcnMvc2xhY2tCb3RIZWxwZXJzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ3JDLElBQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBQ2xELElBQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0FBQ2hELElBQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0FBQ3RELElBQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBQ2xELElBQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0FBQ2hELElBQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0FBQ3hELElBQU0sQ0FBQyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUN2QixJQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDakMsSUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLCtCQUErQixDQUFDLENBQUM7QUFDekQsSUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLDRCQUE0QixDQUFDLENBQUM7O0FBRTFELE1BQU0sQ0FBQyxPQUFPLEdBQUc7Ozs7QUFJYixZQUFVLEVBQUUsb0JBQVMsS0FBSyxFQUFDO0FBQ3pCLFFBQUksUUFBUSxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztBQUN6QixXQUFPLENBQUMsR0FBRyxDQUFDLDhCQUE4QixDQUFDLENBQUM7QUFDNUMsUUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO0FBQ25CLFNBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRyxFQUFDO0FBQ3JDLGFBQU8sQ0FBQyxHQUFH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Q0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUM7QUFDdkUsZUFBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQTtBQUMxQyxZQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxTQUFTLEVBQUUsS0FBSyxNQUFNLEVBQUUsQ0FBQyxTQUFTLEVBQUUsRUFBRTtBQUN4RSxpQkFBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDMUIsZUFBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNwQjtPQUNKLENBQUMsQ0FBQztBQUNILGFBQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFBO0FBQzNCLGNBQVEsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7S0FDM0IsQ0FBQyxDQUNELEtBQUssQ0FBQyxVQUFDLEdBQUcsRUFBSztBQUNaLGFBQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztLQUNoQyxDQUFDLENBQUM7QUFDSCxXQUFPLFFBQVEsQ0FBQyxPQUFPLENBQUM7R0FDM0I7Q0FJSixDQUFDIiwiZmlsZSI6InNlcnZlcl9hc3NldHMvY29udHJvbGxlcnMvc2xhY2tCb3RIZWxwZXJzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xuY29uc3QgUG9zaXRpb24gPSByZXF1aXJlKCcuLi9tb2RlbHMvUG9zaXRpb24uanMnKTtcbmNvbnN0IENvbXBhbnkgPSByZXF1aXJlKCcuLi9tb2RlbHMvQ29tcGFueS5qcycpO1xuY29uc3QgRGVwYXJ0bWVudCA9IHJlcXVpcmUoJy4uL21vZGVscy9EZXBhcnRtZW50LmpzJyk7XG5jb25zdCBFbXBsb3llZSA9IHJlcXVpcmUoJy4uL21vZGVscy9FbXBsb3llZS5qcycpO1xuY29uc3QgUHJvamVjdCA9IHJlcXVpcmUoJy4uL21vZGVscy9Qcm9qZWN0LmpzJyk7XG5jb25zdCBQcm9qZWN0VGFzayA9IHJlcXVpcmUoJy4uL21vZGVscy9Qcm9qZWN0VGFzay5qcycpO1xuY29uc3QgUSA9IHJlcXVpcmUoJ3EnKTtcbmNvbnN0IG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudCcpO1xuY29uc3QgaGVscGVycyA9IHJlcXVpcmUoJy4uL2NvbnRyb2xsZXJzL3Byb2plY3RIZWxwZXJzJyk7XG5jb25zdCBwcm9qZWN0Q3RybCA9IHJlcXVpcmUoJy4uL2NvbnRyb2xsZXJzL3Byb2plY3RDdHJsJyk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gIC8qKioqKioqKioqKioqKiBBUlJBWVMgKioqKioqKioqKioqKiovXG5cbiAgICBhcnJheU1ha2VyOiBmdW5jdGlvbihhcnJheSl7XG4gICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgICBjb25zb2xlLmxvZyhcIkknbSB0cnlpbmcgdG8gbWFrZSBhbiBhcnJheSFcIik7XG4gICAgICB2YXIgbWFkZUFycmF5ID0gW107XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSArKyl7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiSGVyZSdzIHRoZSBuYW1lIEknbSBsb29raW5nIGF0Li4uLlwiLCBhcnJheVtpXS5uYW1lKTtcbiAgICAgICAgbWFkZUFycmF5LnB1c2goYXJyYXlbaV0ubmFtZSk7XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZyhcIkhlcmUncyB0aGUgZnVsbCBhcnJheSBJIG1hZGUgYW5kIGFtIHRyeWluZyB0byByZXR1cm5cIiwgbWFkZUFycmF5KTtcbiAgICAgIGRlZmVycmVkLnJlc29sdmUobWFkZUFycmF5KTtcbiAgICAgIGNvbnNvbGUubG9nKFwiVGhpcyBpcyB0aGUgZGVmZXJyZWQgcHJvbWlzZVwiLCBkZWZlcnJlZC5wcm9taXNlKTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH0sXG5cbiAgICBhcnJheU1ha2VyRW1wbG95ZWVOYW1lOiBmdW5jdGlvbihhcnJheSl7XG4gICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgICBjb25zb2xlLmxvZyhcIkknbSB0cnlpbmcgdG8gbWFrZSBhbiBhcnJheSFcIixhcnJheSk7XG4gICAgICB2YXIgbWFkZUFycmF5ID0gW107XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSArKyl7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiSGVyZSdzIHRoZSBuYW1lIEknbSBsb29raW5nIGF0Li4uLlwiLCBhcnJheVtpXS5pZGVudGlmaWNhdGlvbi5uYW1lLmZ1bGxOYW1lKTtcbiAgICAgICAgbWFkZUFycmF5LnB1c2goYXJyYXlbaV0uaWRlbnRpZmljYXRpb24ubmFtZS5mdWxsTmFtZSk7XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZyhcIkhlcmUncyB0aGUgZnVsbCBhcnJheSBJIG1hZGUgYW5kIGFtIHRyeWluZyB0byByZXR1cm5cIiwgbWFkZUFycmF5KTtcbiAgICAgIGRlZmVycmVkLnJlc29sdmUobWFkZUFycmF5KTtcbiAgICAgIGNvbnNvbGUubG9nKFwiVGhpcyBpcyB0aGUgZGVmZXJyZWQgcHJvbWlzZVwiLCBkZWZlcnJlZC5wcm9taXNlKTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH0sXG5cbi8qKioqKioqKioqKioqKiBBVFRBQ0hNRU5UUyAqKioqKioqKioqKioqKi9cblxuICAgIGF0dGFjaG1lbnRNYWtlcjogZnVuY3Rpb24oYXJyYXksYXR0YWNobWVudFRpdGxlKXtcbiAgICAgIGNvbnNvbGUubG9nKFwiSGVyZSdzIHRoZSBhcnJheSB0byBiZSB0dXJuZWQgaW50byBhbiBhdHRhY2hlbWVudFwiLCBhcnJheSwgYXR0YWNobWVudFRpdGxlKTtcbiAgICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcbiAgICAgIGNvbnNvbGUubG9nKFwiSSdtIHRyeWluZyB0byBtYWtlIGEgbmljZSBhdHRhY2htZW50IGZvciB5b3UuLi4uXCIpO1xuICAgICAgdmFyIGF0dGFjaG1lbnQgPSB7XG4gICAgICAgIHRpdGxlOiBhdHRhY2htZW50VGl0bGUsXG4gICAgICAgIGNvbG9yOiAnIzdGRUZCRCcsXG4gICAgICAgIGZpZWxkczogW10sXG4gICAgICB9O1xuXG4gICAgICBmb3IodmFyIGogPSAwOyBqIDwgYXJyYXkubGVuZ3RoOyBqICsrKXtcbiAgICAgICAgYXR0YWNobWVudC5maWVsZHMucHVzaCh7XG4gICAgICAgICAgbGFiZWw6ICdGaWVsZCcsXG4gICAgICAgICAgdmFsdWU6IGFycmF5W2pdLFxuICAgICAgICAgIHNob3J0OiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY29uc29sZS5sb2coYXR0YWNobWVudCk7XG4gICAgICBkZWZlcnJlZC5yZXNvbHZlKGF0dGFjaG1lbnQpO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcblxuICAgIGhlbHBBdHRhY2htZW50OiBmdW5jdGlvbihhcnJheSxhdHRhY2htZW50VGl0bGUpe1xuICAgICAgY29uc29sZS5sb2coXCJIZXJlJ3MgdGhlIGFycmF5IHRvIGJlIHR1cm5lZCBpbnRvIGFuIGF0dGFjaGVtZW50XCIsIGFycmF5LCBhdHRhY2htZW50VGl0bGUpO1xuICAgICAgdmFyIGRlZmVycmVkID0gUS5kZWZlcigpO1xuICAgICAgY29uc29sZS5sb2coXCJJJ20gdHJ5aW5nIHRvIG1ha2UgYSBuaWNlIGF0dGFjaG1lbnQgZm9yIHlvdS4uLi5cIik7XG4gICAgICB2YXIgYXR0YWNobWVudCA9IHtcbiAgICAgICAgdGl0bGU6IGF0dGFjaG1lbnRUaXRsZSxcbiAgICAgICAgY29sb3I6ICcjN0ZFRkJEJyxcbiAgICAgICAgZmllbGRzOiBbe1xuICAgICAgICAgIGxhYmVsOiAnRmllbGQnLFxuICAgICAgICAgIHRpdGxlOiAnICcsXG4gICAgICAgICAgdmFsdWU6IFwiSGkuXFxuIEkgZGlkbid0IHVuZGVyc3RhbmQgd2hhdCB5b3Ugd2FudC4gXFxuQnV0IGRvbid0IHdvcnJ5Li4uIEknbSBoZXJlIHRvIGhlbHAuIFxcbkJlZm9yZSB5b3UgcGFuaWMgY2hlY2sgb3V0IHRoaXMgbGlzdCBvZiBjb21tYW5kcyB0byBnZXQgdGhlIGluZm8geW91IG5lZWQuIEJlY2F1c2UgSSdtIGFydGlmaWNhbGx5IGludGVsbGlnZW50LCBpZiB5b3UgdHlwZSBhbnl0aGluZyBjbG9zZSB0byB0aGUgY29tbWFuZHMgYmVsb3cgSSdsbCBwcm9iYWJseSBnaXZlIHlvdSB3aGF0IHlvdXIgbG9va2luZyBmb3IuIElmIG5vdCwganVzdCB0eXBlIHRoZSBjbG9zZXN0IGNvbW1hbmQgZXhhY3RseS4gT3ZlciB0aW1lIEknbGwgZ2V0IGJldHRlciBhbmQgYmV0dGVyIGF0IHVuZGVyc3RhbmRpbmcgeW91ciBpbnRlbnQsIHNvIGdldCB0byB3b3JrIVxcblwiLFxuICAgICAgICAgIHNob3J0OiBmYWxzZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGxhYmVsOiAnRmllbGQnLFxuICAgICAgICAgIHZhbHVlOiAnICcsXG4gICAgICAgICAgc2hvcnQ6IHRydWUsXG4gICAgICAgIH0se1xuICAgICAgICAgIGxhYmVsOiAnRmllbGQnLFxuICAgICAgICAgIHZhbHVlOiAnICcsXG4gICAgICAgICAgc2hvcnQ6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBsYWJlbDogJ0ZpZWxkJyxcbiAgICAgICAgICB2YWx1ZTogJypDb21tYW5kKicsXG4gICAgICAgICAgc2hvcnQ6IHRydWUsXG4gICAgICAgIH0se1xuICAgICAgICAgIGxhYmVsOiAnRmllbGQnLFxuICAgICAgICAgIHZhbHVlOiAnKkRlc2NyaXB0aW9uKicsXG4gICAgICAgICAgc2hvcnQ6IHRydWUsXG4gICAgICAgIH1dLFxuICAgICAgICBtcmtkd25faW46IFsnZmllbGRzJ11cbiAgICAgIH07XG5cbiAgICAgIGZvcih2YXIgaiA9IDA7IGogPCBhcnJheS5sZW5ndGg7IGogKyspe1xuICAgICAgICBhdHRhY2htZW50LmZpZWxkcy5wdXNoKHtcbiAgICAgICAgICBsYWJlbDogJ0ZpZWxkJyxcbiAgICAgICAgICB2YWx1ZTogYXJyYXlbal0sXG4gICAgICAgICAgc2hvcnQ6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZyhhdHRhY2htZW50KTtcbiAgICAgIGRlZmVycmVkLnJlc29sdmUoYXR0YWNobWVudCk7XG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9LFxuXG4gICAgcHJvamVjdHNBdHRhY2htZW50OiBmdW5jdGlvbihhcnJheSxhdHRhY2htZW50VGl0bGUpe1xuICAgICAgY29uc29sZS5sb2coXCJIZXJlJ3MgdGhlIGFycmF5IHRvIGJlIHR1cm5lZCBpbnRvIGFuIGF0dGFjaG1lbnRcIiwgYXJyYXksIGF0dGFjaG1lbnRUaXRsZSk7XG4gICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgICBjb25zb2xlLmxvZyhcIkknbSB0cnlpbmcgdG8gbWFrZSBhIG5pY2UgYXR0YWNobWVudCBmb3IgeW91Li4uLlwiKTtcbiAgICAgIHZhciBhdHRhY2htZW50ID0ge1xuICAgICAgICB0aXRsZTogYXR0YWNobWVudFRpdGxlLFxuICAgICAgICBjb2xvcjogJyM3RkVGQkQnLFxuICAgICAgICBmaWVsZHM6IFtdLFxuICAgICAgICBtcmtkd25faW46IFsnZmllbGRzJ11cbiAgICAgIH07XG5cbiAgICAgIGZvcih2YXIgaiA9IDA7IGogPCBhcnJheS5sZW5ndGg7IGogKyspe1xuICAgICAgICBhdHRhY2htZW50LmZpZWxkcy5wdXNoKHtcbiAgICAgICAgICBsYWJlbDogJ0ZpZWxkJyxcbiAgICAgICAgICB2YWx1ZTogXCJfI1wiICsgYXJyYXlbal0uZnJpZW5kbHlJZCArIFwiXzogKlwiICsgYXJyYXlbal0ubmFtZSArIFwiKiAtIFwiICsgYXJyYXlbal0uZGVzY3JpcHRpb24gKyBcIiAtICpEdWUgOiAqXCIgKyBtb21lbnQoYXJyYXlbal0uc2V0dXAuZHVlRGF0ZS5hY3R1YWwpLmZvcm1hdCgnZGRkZCwgTU1NTSBEbycpICsgXCIgLSAqU3RhdHVzOiAqXCIgKyBhcnJheVtqXS5zdGF0dXMsXG4gICAgICAgICAgc2hvcnQ6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgZGVmZXJyZWQucmVzb2x2ZShhdHRhY2htZW50KTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH0sXG5cbiAgICB0YXNrQXR0YWNobWVudDogZnVuY3Rpb24oYXJyYXksYXR0YWNobWVudFRpdGxlKXtcbiAgICAgIGNvbnNvbGUubG9nKFwiSGVyZSdzIHRoZSBhcnJheSB0byBiZSB0dXJuZWQgaW50byBhbiBhdHRhY2htZW50XCIsIGFycmF5LCBhdHRhY2htZW50VGl0bGUpO1xuICAgICAgdmFyIGRlZmVycmVkID0gUS5kZWZlcigpO1xuICAgICAgY29uc29sZS5sb2coXCJJJ20gdHJ5aW5nIHRvIG1ha2UgYSBuaWNlIGF0dGFjaG1lbnQgZm9yIHlvdS4uLi5cIik7XG4gICAgICB2YXIgYXR0YWNobWVudCA9IHtcbiAgICAgICAgdGl0bGU6IGF0dGFjaG1lbnRUaXRsZSxcbiAgICAgICAgY29sb3I6ICcjN0ZFRkJEJyxcbiAgICAgICAgZmllbGRzOiBbXSxcbiAgICAgICAgbXJrZHduX2luOiBbJ2ZpZWxkcyddXG4gICAgICB9O1xuXG4gICAgICBmb3IodmFyIGogPSAwOyBqIDwgYXJyYXkubGVuZ3RoOyBqICsrKXtcbiAgICAgICAgYXR0YWNobWVudC5maWVsZHMucHVzaCh7XG4gICAgICAgICAgbGFiZWw6ICdGaWVsZCcsXG4gICAgICAgICAgdmFsdWU6IFwiXyNcIiArIGFycmF5W2pdLmZyaWVuZGx5SWQgKyBcIl86ICpcIiArIGFycmF5W2pdLm5hbWUgKyAgXCIgLSAqU3RhdHVzOiAqXCIgKyBhcnJheVtqXS5zdGF0dXMsXG4gICAgICAgICAgc2hvcnQ6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgZGVmZXJyZWQucmVzb2x2ZShhdHRhY2htZW50KTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH0sXG5cbiAgICAvKioqKioqKioqKioqKiogRk9STUFUVElORyAqKioqKioqKioqKioqKi9cblxuICAgIGhhc2hTdHJpcHBlcjogZnVuY3Rpb24oaWQpe1xuICAgICAgY29uc29sZS5sb2coXCJIZXJlJ3MgdGhlIGlkIEknbSB0cnlpbmcgdG8gZml4XCIsIGlkKTtcbiAgICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcbiAgICAgIGlmKGlkLmNoYXJBdCgwKSAhPT0gXCIjXCIpIHtcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShpZCk7XG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGNsZWFuSWQgPSBpZC5zcGxpdCgnIycpO1xuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGNsZWFuSWRbMV0pO1xuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgIH1cbiAgICB9LFxuXG5cbiAgICAvKioqKioqKioqKioqKiogUVVFUklFUyAtIERFUEFSVE1FTlRTICAqKioqKioqKioqKioqKi9cbiAgICBhbGxEZXBhcnRtZW50czogZnVuY3Rpb24ocmVxLCByZXMpIHtcbiAgICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcbiAgICAgIERlcGFydG1lbnQuZmluZCgpLmV4ZWMoKVxuICAgICAgICAudGhlbigoZGVwYXJ0bWVudHMpID0+IHtcbiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRlcGFydG1lbnRzKTtcbiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5lbmQoKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcblxuICAgIC8qKioqKioqKioqKioqKiBRVUVSSUVTIC0gRU1QTE9ZRUVTICAqKioqKioqKioqKioqKi9cbiAgICBhbGxFbXBsb3llZXM6IGZ1bmN0aW9uKHJlcSwgcmVzKSB7XG4gICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgICBFbXBsb3llZS5maW5kKCkuZXhlYygpXG4gICAgICAgIC50aGVuKChlbXBsb3llZXMpID0+IHtcbiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGVtcGxveWVlcyk7XG4gICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuZW5kKCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH0sXG5cbiAgICAvKioqKioqKioqKioqKiogUVVFUklFUyAtIFBPU0lUSU9OUyAgKioqKioqKioqKioqKiovXG4gICAgYWxsUG9zaXRpb25zOiBmdW5jdGlvbihyZXEsIHJlcykge1xuICAgICAgdmFyIGRlZmVycmVkID0gUS5kZWZlcigpO1xuICAgICAgUG9zaXRpb24uZmluZCgpLmV4ZWMoKVxuICAgICAgICAudGhlbigocG9zaXRpb25zKSA9PiB7XG4gICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShwb3NpdGlvbnMpO1xuICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmVuZCgpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9LFxuXG5cblxuICAgIC8qKioqKioqKioqKioqKiBRVUVSSUVTIC0gUFJPSkVDVFMgICoqKioqKioqKioqKioqL1xuICAgIGFsbFByb2plY3RzOiBmdW5jdGlvbihyZXEsIHJlcykge1xuICAgICAgdmFyIGRlZmVycmVkID0gUS5kZWZlcigpO1xuICAgICAgUHJvamVjdC5maW5kKCkuZXhlYygpXG4gICAgICAgIC50aGVuKChwcm9qZWN0cykgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiSGVyZSdzIHRoZSBwcm9qZWN0cyBJIGZvdW5kLi4uXCIscHJvamVjdHMpO1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocHJvamVjdHMpO1xuICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmVuZCgpO1xuICAgICAgfSk7XG4gICAgICBjb25zb2xlLmxvZyhkZWZlcnJlZC5wcm9taXNlKTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH0sXG5cbiAgICBhbGxJbmNvbXBsZXRlUHJvamVjdHM6IGZ1bmN0aW9uKHJlcSwgcmVzKSB7XG4gICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgICBQcm9qZWN0LmZpbmQoKS5leGVjKClcbiAgICAgICAgLnRoZW4oKHByb2plY3RzKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJIZXJlJ3MgdGhlIGluY29tcGxldGUgcHJvamVjdHMgSSBmb3VuZC4uLlwiLCBwcm9qZWN0cyk7XG4gICAgICAgICAgY29uc3QgaW5jb21wbGV0ZVByb2plY3RzID0gW107XG4gICAgICAgICAgcHJvamVjdHMubWFwKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSVRFTVwiLCBpdGVtKTtcbiAgICAgICAgICAgICAgaWYgKGl0ZW0uc3RhdHVzID09PSAnSW5jb21wbGV0ZScpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJTkNPTVBMRVRFIFBST0pFQ1RTJywgaXRlbSk7XG4gICAgICAgICAgICAgICAgICBpbmNvbXBsZXRlUHJvamVjdHMucHVzaChpdGVtKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoaW5jb21wbGV0ZVByb2plY3RzKTtcbiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5lbmQoKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcblxuICAgIGFsbENvbXBsZXRlUHJvamVjdHM6IGZ1bmN0aW9uKHJlcSwgcmVzKSB7XG4gICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgICBQcm9qZWN0LmZpbmQoKS5leGVjKClcbiAgICAgICAgLnRoZW4oKHByb2plY3RzKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJIZXJlJ3MgdGhlIENvbXBsZXRlIHByb2plY3RzIEkgZm91bmQuLi5cIiwgcHJvamVjdHMpO1xuICAgICAgICAgIGNvbnN0IGNvbXBsZXRlUHJvamVjdHMgPSBbXTtcbiAgICAgICAgICBwcm9qZWN0cy5tYXAoKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJVEVNXCIsIGl0ZW0pO1xuICAgICAgICAgICAgICBpZiAoaXRlbS5zdGF0dXMgPT09ICdDb21wbGV0ZScpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDT01QTEVURSBQUk9KRUNUUycsIGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgY29tcGxldGVQcm9qZWN0cy5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShjb21wbGV0ZVByb2plY3RzKTtcbiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5lbmQoKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcblxuICAgIC8qKioqKioqKioqKioqKiBRVUVSSUVTIC0gUFJPSkVDVCBUQVNLUyAgKioqKioqKioqKioqKiovXG4gICAgYWxsUHJvamVjdFRhc2tzOiBmdW5jdGlvbihyZXEscmVzKXtcbiAgICAgIGNvbnNvbGUubG9nKFwiTWFkZSBpdCB0byBhbGwgcHJvamVjdCB0YXNrcyFcIik7XG4gICAgdmFyIGRlZmVycmVkID0gUS5kZWZlcigpO1xuICAgIFByb2plY3RUYXNrLmZpbmQoKS5leGVjKCkudGhlbigocmVzdWx0cykgPT4ge1xuICAgICAgY29uc29sZS5sb2coXCJUaGlzIGlzIHdoYXQgSSBmb3VuZCBmb3IgYWxsIHRoZSB0YXNrc1wiLCByZXN1bHRzKTtcbiAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzdWx0cyk7XG4gICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuZW5kKCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH0sXG5cbiAgICBhbGxJbmNvbXBsZXRlVGFza3M6IGZ1bmN0aW9uKHJlcSxyZXMpe1xuICAgICAgY29uc29sZS5sb2coXCJNYWRlIGl0IHRvIGFsbCBpbmNvbXBsZXRlIHRhc2tzIVwiKTtcbiAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgUHJvamVjdFRhc2suZmluZCgpLmV4ZWMoKS50aGVuKChyZXN1bHRzKSA9PiB7XG4gICAgICAgIGNvbnN0IGluY29tcGxldGVUYXNrcyA9IFtdO1xuICAgICAgICByZXN1bHRzLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJUQVNLXCIsIGl0ZW0pO1xuICAgICAgICAgICAgaWYgKGl0ZW0uc3RhdHVzID09PSAnSW5jb21wbGV0ZScpIHtcbiAgICAgICAgICAgICAgICBpbmNvbXBsZXRlVGFza3MucHVzaChpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICBkZWZlcnJlZC5yZXNvbHZlKGluY29tcGxldGVUYXNrcyk7XG4gICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuZW5kKCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH0sXG5cbiAgICB0YXNrc0luUHJvamVjdDogZnVuY3Rpb24oaWQpe1xuICAgICAgY29uc29sZS5sb2coXCJIZXJlJ3MgdGhlIGlkIEknbSBsb29raW5nIGZvclwiLCBpZCk7XG4gICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgICBQcm9qZWN0LmZpbmQoe1wiZnJpZW5kbHlJZFwiOmlkfSlcbiAgICAgIC5wb3B1bGF0ZSgndGFza3MnKVxuICAgICAgLmV4ZWMoKVxuICAgICAgLnRoZW4oKHJlc3VsdCk9PntcbiAgICAgICAgY29uc29sZS5sb2coXCJkaWQgaSBmaW5kIGEgcHJvamVjdD9cIiwgcmVzdWx0KTtcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgfSkuY2F0Y2goKGVycik9PiB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuZW5kKCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH0sXG4gICAgXG4gICAgdGFza0NvbXBsZXRlKGlkKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkhlcmUncyB0aGUgaWQgSSdtIGxvb2tpbmcgZm9yXCIsIGlkKTtcbiAgICAgICAgdmFyIGRlZmVycmVkID0gUS5kZWZlcigpO1xuICAgICAgICBQcm9qZWN0VGFzay5maW5kT25lQW5kVXBkYXRlKHtcImZyaWVuZGx5SWRcIjogaWR9LCB7c3RhdHVzOiAnQ29tcGxldGUnfSwge25ldzogdHJ1ZX0pXG4gICAgICAgIC5leGVjKClcbiAgICAgICAgLnRoZW4oKG5ld1Rhc2spID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUkVTVUxUXCIsIG5ld1Rhc2spO1xuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShuZXdUYXNrKTtcbiAgICAgICAgfSlcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcbiAgICBcbiAgICBzdGF0dXNDaGVjayhpZCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIklEXCIsIGlkKTtcbiAgICAgICAgdmFyIGRlZmVycmVkID0gUS5kZWZlcigpO1xuICAgICAgICBQcm9qZWN0VGFzay5maW5kKHtcImZyaWVuZGx5SWRcIjogaWR9KVxuICAgICAgICAuZXhlYygpXG4gICAgICAgIC50aGVuKCh0YXNrKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnVEFTSycsIHRhc2spO1xuICAgICAgICAgICAgICBpZiAodGFza1swXS5zdGF0dXMgPT09ICdDb21wbGV0ZScpe1xuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZmFsc2UpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHRhc2spO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgfSlcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcbiAgICBcbiAgICB0YXNrQ29tcGxldGVDb3VudChwcm9qZWN0SWQpIHtcbiAgICAgICAgdmFyIGRlZmVycmVkID0gUS5kZWZlcigpO1xuICAgICAgICB2YXIgb2xkUHJvamVjdDtcbiAgICAgICAgUHJvamVjdC5maW5kKHsnX2lkJzogcHJvamVjdElkfSlcbiAgICAgICAgLmV4ZWMoKVxuICAgICAgICAudGhlbigocHJvamVjdCkgPT4ge1xuICAgICAgICAgICAgcHJvamVjdFswXS50YXNrc0NvbXBsZXRlZCsrO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCIjIFRBU0tTIENPTVBMRVRFRFwiLCBwcm9qZWN0WzBdLnRhc2tzQ29tcGxldGVkKTtcbiAgICAgICAgICAgIGlmIChwcm9qZWN0WzBdLnRhc2tzQ29tcGxldGVkID09PSBwcm9qZWN0WzBdLnRhc2tzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHByb2plY3RbMF0uc3RhdHVzID0gJ0NvbXBsZXRlJztcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIklTIFBST0pFQ1QgQ09NUExFVEU/XCIsIHByb2plY3RbMF0uc3RhdHVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJUyBUSElTIEEgUFJPTUlTRT8nLCBwcm9qZWN0WzBdLnNhdmUoKSk7XG4gICAgICAgICAgICByZXR1cm4gcHJvamVjdFswXS5zYXZlKCk7XG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKChwcm9qZWN0KSA9PiB7XG4gICAgICAgICAgICBpZiAocHJvamVjdC5zdGF0dXMgPT09ICdDb21wbGV0ZScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvamVjdEN0cmwubmV3UHJvamVjdChwcm9qZWN0LnNldHVwLmFzc29jaWF0ZWRUZW1wbGF0ZSk7ICAgXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oKG5ld1Byb2plY3QpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdESUQgSVQgV09SSz8nLCBuZXdQcm9qZWN0KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKioqKioqKioqKioqKiBRVUVSSUVTIC0gRFVFIERBVEVTICAqKioqKioqKioqKioqKi9cblxuICAgIG92ZXJkdWVQcm9qZWN0cyhyZXEsIHJlcykge1xuICAgICAgICBjb25zb2xlLmxvZyhcIk1hZGUgaXQgdG8gb3ZlcmR1ZSBwcm9qZWN0cyFcIik7XG4gICAgICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcbiAgICAgICAgUHJvamVjdC5maW5kKCkuZXhlYygpXG4gICAgICAgIC50aGVuKChwcm9qZWN0cykgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1BST0pFQ1RTJywgcHJvamVjdHMpO1xuICAgICAgICAgICAgdmFyIG92ZXJkdWUgPSBbXTtcbiAgICAgICAgICAgIHByb2plY3RzLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJVEVNMScsIGl0ZW0uc2V0dXAuZHVlRGF0ZS5hY3R1YWwpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJVEVNMicsIG1vbWVudCgpKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnVFJVRSBPUiBGQUxTRScsIG1vbWVudCgpLmlzQWZ0ZXIobW9tZW50KGl0ZW0uc2V0dXAuZHVlRGF0ZS5hY3R1YWwpKSk7XG4gICAgICAgICAgICAgICAgaWYgKG1vbWVudCgpLmlzQWZ0ZXIobW9tZW50KGl0ZW0uc2V0dXAuZHVlRGF0ZS5hY3R1YWwpKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zdGF0dXMgPT09ICdJbmNvbXBsZXRlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0lURU0zJywgaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBvdmVyZHVlLnB1c2goaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUob3ZlcmR1ZSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmVuZCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcblxuICAgIG92ZXJkdWVUYXNrcyhyZXEsIHJlcykge1xuICAgICAgICBjb25zb2xlLmxvZyhcIk1hZGUgaXQgdG8gb3ZlcmR1ZSB0YXNrcyFcIik7XG4gICAgICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcbiAgICAgICAgUHJvamVjdFRhc2suZmluZCgpLmV4ZWMoKVxuICAgICAgICAudGhlbigodGFza3MpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUQVNLUycsIHRhc2tzKTtcbiAgICAgICAgICAgIHZhciBvdmVyZHVlID0gW107XG4gICAgICAgICAgICB0YXNrcy5tYXAoKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnSVRFTTEnLCBtb21lbnQoaXRlbS5kYXRlLmRlYWRsaW5lKSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0lURU0yJywgbW9tZW50KCkpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUUlVFIE9SIEZBTFNFJywgbW9tZW50KCkuaXNBZnRlcihtb21lbnQoaXRlbS5kYXRlLmRlYWRsaW5lKSkpO1xuICAgICAgICAgICAgICAgIGlmIChtb21lbnQoKS5pc0FmdGVyKG1vbWVudChpdGVtLmRhdGUuZGVhZGxpbmUpKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnSVRFTTMnLCBpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgb3ZlcmR1ZS5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShvdmVyZHVlKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuZW5kKCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9LFxuXG4gICAgcHJvamVjdHNEdWVUaGlzV2VlayhyZXEsIHJlcykge1xuICAgICAgICBjb25zb2xlLmxvZyhcIk1hZGUgaXQgdG8gcHJvamVjdHNEdWVUaGlzV2Vla1wiKTtcbiAgICAgICAgdmFyIGRlZmVycmVkID0gUS5kZWZlcigpO1xuICAgICAgICBQcm9qZWN0LmZpbmQoKS5leGVjKClcbiAgICAgICAgLnRoZW4oKHByb2plY3RzKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnUFJPSkVDVFMnLCBwcm9qZWN0cyk7XG4gICAgICAgICAgICB2YXIgd2VlayA9IFtdO1xuICAgICAgICAgICAgcHJvamVjdHMubWFwKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJXRUVLXCIsIG1vbWVudChpdGVtLnNldHVwLmR1ZURhdGUuYWN0dWFsKS53ZWVrKCkpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ1VSUkVOVCBXRUVLXCIsIG1vbWVudCgpLndlZWsoKSk7XG4gICAgICAgICAgICAgICAgaWYgKG1vbWVudCgpLndlZWsoKSA9PT0gbW9tZW50KGl0ZW0uc2V0dXAuZHVlRGF0ZS5hY3R1YWwpLndlZWsoKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnSVRFTScsIGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICB3ZWVrLnB1c2goaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHdlZWspO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5lbmQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH0sXG5cbiAgICBwcm9qZWN0c0R1ZVRoaXNNb250aChyZXEsIHJlcykge1xuICAgICAgICBjb25zb2xlLmxvZyhcIk1hZGUgaXQgdG8gcHJvamVjdHNEdWVUaGlzTW9udGhcIik7XG4gICAgICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcbiAgICAgICAgUHJvamVjdC5maW5kKCkuZXhlYygpXG4gICAgICAgIC50aGVuKChwcm9qZWN0cykgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1BST0pFQ1RTJywgcHJvamVjdHMpXG4gICAgICAgICAgICB2YXIgbW9udGggPSBbXTtcbiAgICAgICAgICAgIHByb2plY3RzLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTU9OVEhcIiwgbW9tZW50KGl0ZW0uc2V0dXAuZHVlRGF0ZS5hY3R1YWwpLm1vbnRoKCkpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ1VSUkVOVCBNT05USFwiLCBtb21lbnQoKS5tb250aCgpKTtcbiAgICAgICAgICAgICAgICBpZiAobW9tZW50KCkubW9udGgoKSA9PT0gbW9tZW50KGl0ZW0uc2V0dXAuZHVlRGF0ZS5hY3R1YWwpLm1vbnRoKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0lURU0nLCBpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgbW9udGgucHVzaChpdGVtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUobW9udGgpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5lbmQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH0sXG5cbiAgICBwcm9qZWN0c0R1ZVRvZGF5KHJlcSwgcmVzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiTWFkZSBpdCB0byBwcm9qZWN0c0R1ZVRvZGF5XCIpO1xuICAgICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgICAgIFByb2plY3QuZmluZCgpLmV4ZWMoKVxuICAgICAgICAudGhlbigocHJvamVjdHMpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQUk9KRUNUUycsIHByb2plY3RzKVxuICAgICAgICAgICAgdmFyIHRvZGF5ID0gW107XG4gICAgICAgICAgICBwcm9qZWN0cy5tYXAoKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRVRSBEQVRFXCIsIG1vbWVudChpdGVtLnNldHVwLmR1ZURhdGUuYWN0dWFsKS5kYXlPZlllYXIoKSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJUT0RBWVwiLCBtb21lbnQoKS5kYXlPZlllYXIoKSlcbiAgICAgICAgICAgICAgICBpZiAobW9tZW50KGl0ZW0uc2V0dXAuZHVlRGF0ZS5hY3R1YWwpLmRheU9mWWVhcigpID09PSBtb21lbnQoKS5kYXlPZlllYXIoKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnSVRFTScsIGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICB0b2RheS5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJBUlJBWVwiLCB0b2RheSlcbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUodG9kYXkpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5lbmQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH0sXG5cblxuXG59O1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
