'use strict';

var mongoose = require('mongoose');
var Position = require('../models/Position.js');
var Company = require('../models/Company.js');
var Department = require('../models/Department.js');
var Employee = require('../models/Employee.js');
var Project = require('../models/Project.js');
var ProjectTask = require('../models/ProjectTask.js');
var Q = require('q');
var moment = require('moment');
var helpers = require('../controllers/projectHelpers');
var projectCtrl = require('../controllers/projectCtrl');

module.exports = {

  /************** ARRAYS **************/

  arrayMaker: function arrayMaker(array) {
    var deferred = Q.defer();
    console.log("I'm trying to make an array!");
    var madeArray = [];
    for (var i = 0; i < array.length; i++) {
      console.log("Here's the name I'm looking at....", array[i].name);
      madeArray.push(array[i].name);
    }
    console.log("Here's the full array I made and am trying to return", madeArray);
    deferred.resolve(madeArray);
    console.log("This is the deferred promise", deferred.promise);
    return deferred.promise;
  },

  arrayMakerEmployeeName: function arrayMakerEmployeeName(array) {
    var deferred = Q.defer();
    console.log("I'm trying to make an array!", array);
    var madeArray = [];
    for (var i = 0; i < array.length; i++) {
      console.log("Here's the name I'm looking at....", array[i].identification.name.fullName);
      madeArray.push(array[i].identification.name.fullName);
    }
    console.log("Here's the full array I made and am trying to return", madeArray);
    deferred.resolve(madeArray);
    console.log("This is the deferred promise", deferred.promise);
    return deferred.promise;
  },

  /************** ATTACHMENTS **************/

  attachmentMaker: function attachmentMaker(array, attachmentTitle) {
    console.log("Here's the array to be turned into an attachement", array, attachmentTitle);
    var deferred = Q.defer();
    console.log("I'm trying to make a nice attachment for you....");
    var attachment = {
      title: attachmentTitle,
      color: '#7FEFBD',
      fields: []
    };

    for (var j = 0; j < array.length; j++) {
      attachment.fields.push({
        label: 'Field',
        value: array[j],
        short: true
      });
    }
    console.log(attachment);
    deferred.resolve(attachment);
    return deferred.promise;
  },

  helpAttachment: function helpAttachment(array, attachmentTitle) {
    console.log("Here's the array to be turned into an attachement", array, attachmentTitle);
    var deferred = Q.defer();
    console.log("I'm trying to make a nice attachment for you....");
    var attachment = {
      title: attachmentTitle,
      color: '#7FEFBD',
      fields: [{
        label: 'Field',
        title: ' ',
        value: "Hi.\n I didn't understand what you want. \nBut don't worry... I'm here to help. \nBefore you panic check out this list of commands to get the info you need. Because I'm artifically intelligent, if you type anything close to the commands below I'll probably give you what your looking for. If not, just type the closest command exactly. Over time I'll get better and better at understanding your intent, so get to work!\n",
        short: false
      }, {
        label: 'Field',
        value: ' ',
        short: true
      }, {
        label: 'Field',
        value: ' ',
        short: true
      }, {
        label: 'Field',
        value: '*Command*',
        short: true
      }, {
        label: 'Field',
        value: '*Description*',
        short: true
      }],
      mrkdwn_in: ['fields']
    };

    for (var j = 0; j < array.length; j++) {
      attachment.fields.push({
        label: 'Field',
        value: array[j],
        short: true
      });
    }
    console.log(attachment);
    deferred.resolve(attachment);
    return deferred.promise;
  },

  projectsAttachment: function projectsAttachment(array, attachmentTitle) {
    console.log("Here's the array to be turned into an attachment", array, attachmentTitle);
    var deferred = Q.defer();
    console.log("I'm trying to make a nice attachment for you....");
    var attachment = {
      title: attachmentTitle,
      color: '#7FEFBD',
      fields: [],
      mrkdwn_in: ['fields']
    };

    for (var j = 0; j < array.length; j++) {
      console.log(array[j]);
      attachment.fields.push({
        label: 'Field',
        value: "_#" + array[j].friendlyId + "_: *" + array[j].name + "* - " + array[j].description + " - *# of Tasks (" + array[j].tasks.length + ") - *Due : *" + moment(array[j].setup.dueDate.actual).format('dddd, MMMM Do') + " - *Status: *" + array[j].status,
        short: false
      });
    }
    deferred.resolve(attachment);
    return deferred.promise;
  },

  taskAttachment: function taskAttachment(array, attachmentTitle) {
    console.log("Here's the array to be turned into an attachment", array, attachmentTitle);
    var deferred = Q.defer();
    console.log("I'm trying to make a nice attachment for you....");
    var attachment = {
      title: attachmentTitle,
      color: '#7FEFBD',
      fields: [],
      mrkdwn_in: ['fields']
    };

    for (var j = 0; j < array.length; j++) {
      attachment.fields.push({
        label: 'Field',
        value: "_#" + array[j].friendlyId + "_: *" + array[j].name + " - *Status: *" + array[j].status,
        short: false
      });
    }
    deferred.resolve(attachment);
    return deferred.promise;
  },

  /************** FORMATTING **************/

  hashStripper: function hashStripper(id) {
    console.log("Here's the id I'm trying to fix", id);
    var deferred = Q.defer();
    if (id.charAt(0) !== "#") {
      deferred.resolve(id);
      return deferred.promise;
    } else {
      var cleanId = id.split('#');
      deferred.resolve(cleanId[1]);
      return deferred.promise;
    }
  },

  /************** QUERIES - DEPARTMENTS  **************/
  allDepartments: function allDepartments(req, res) {
    var deferred = Q.defer();
    Department.find().exec().then(function (departments) {
      deferred.resolve(departments);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },

  /************** QUERIES - EMPLOYEES  **************/
  allEmployees: function allEmployees(req, res) {
    var deferred = Q.defer();
    Employee.find().exec().then(function (employees) {
      deferred.resolve(employees);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },

  /************** QUERIES - POSITIONS  **************/
  allPositions: function allPositions(req, res) {
    var deferred = Q.defer();
    Position.find().exec().then(function (positions) {
      deferred.resolve(positions);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },

  /************** QUERIES - PROJECTS  **************/
  allProjects: function allProjects(req, res) {
    var deferred = Q.defer();
    Project.find().exec().then(function (projects) {
      console.log("Here's the projects I found...", projects);
      deferred.resolve(projects);
    }).catch(function (err) {
      return res.status(500).end();
    });
    console.log(deferred.promise);
    return deferred.promise;
  },

  allIncompleteProjects: function allIncompleteProjects(req, res) {
    var deferred = Q.defer();
    Project.find().exec().then(function (projects) {
      console.log("Here's the incomplete projects I found...", projects);
      var incompleteProjects = [];
      projects.map(function (item) {
        console.log("ITEM", item);
        if (item.status === 'Incomplete') {
          console.log('INCOMPLETE PROJECTS', item);
          incompleteProjects.push(item);
        }
      });
      deferred.resolve(incompleteProjects);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },

  allCompleteProjects: function allCompleteProjects(req, res) {
    var deferred = Q.defer();
    Project.find().exec().then(function (projects) {
      console.log("Here's the Complete projects I found...", projects);
      var completeProjects = [];
      projects.map(function (item) {
        console.log("ITEM", item);
        if (item.status === 'Complete') {
          console.log('COMPLETE PROJECTS', item);
          completeProjects.push(item);
        }
      });
      deferred.resolve(completeProjects);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },

  /************** QUERIES - PROJECT TASKS  **************/
  allProjectTasks: function allProjectTasks(req, res) {
    console.log("Made it to all project tasks!");
    var deferred = Q.defer();
    ProjectTask.find().exec().then(function (results) {
      console.log("This is what I found for all the tasks", results);
      deferred.resolve(results);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },

  allIncompleteTasks: function allIncompleteTasks(req, res) {
    console.log("Made it to all incomplete tasks!");
    var deferred = Q.defer();
    ProjectTask.find().exec().then(function (results) {
      var incompleteTasks = [];
      results.map(function (item) {
        console.log("TASK", item);
        if (item.status === 'Incomplete') {
          incompleteTasks.push(item);
        }
      });
      deferred.resolve(incompleteTasks);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },

  tasksInProject: function tasksInProject(id) {
    console.log("Here's the id I'm looking for", id);
    var deferred = Q.defer();
    Project.find({ "friendlyId": id }).populate('tasks').exec().then(function (result) {
      console.log("did i find a project?", result);
      deferred.resolve(result);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },

  taskComplete: function taskComplete(id) {
    console.log("Here's the id I'm looking for", id);
    var deferred = Q.defer();
    ProjectTask.findOneAndUpdate({ "friendlyId": id }, { status: 'Complete' }, { new: true }).exec().then(function (newTask) {
      console.log("RESULT", newTask);
      deferred.resolve(newTask);
    });
    return deferred.promise;
  },
  statusCheck: function statusCheck(id) {
    console.log("ID", id);
    var deferred = Q.defer();
    ProjectTask.find({ "friendlyId": id }).exec().then(function (task) {
      console.log('TASK', task);
      if (task[0].status === 'Complete') {
        deferred.resolve(false);
      } else {
        deferred.resolve(task);
      }
    }).catch(function (err) {
      console.log(err);
    });
    return deferred.promise;
  },
  taskCompleteCount: function taskCompleteCount(projectId) {
    var deferred = Q.defer();
    var oldProject;
    Project.find({ '_id': projectId }).exec().then(function (project) {
      project[0].tasksCompleted++;
      console.log("# TASKS COMPLETED", project[0].tasksCompleted);
      if (project[0].tasksCompleted === project[0].tasks.length) {
        project[0].status = 'Complete';
        console.log("IS PROJECT COMPLETE?", project[0].status);
      }
      console.log('IS THIS A PROMISE?', project[0].save());
      return project[0].save();
    }).then(function (project) {
      if (project.status === 'Complete') {
        return projectCtrl.newProject(project.setup.associatedTemplate);
      } else {
        return;
      }
    }).then(function (newProject) {
      console.log('DID IT WORK?', newProject);
    });
  },

  /************** QUERIES - DUE DATES  **************/

  overdueProjects: function overdueProjects(req, res) {
    console.log("Made it to overdue projects!");
    var deferred = Q.defer();
    Project.find().exec().then(function (projects) {
      console.log('PROJECTS', projects);
      var overdue = [];
      projects.map(function (item) {
        console.log('ITEM1', item.setup.dueDate.actual);
        console.log('ITEM2', moment());
        console.log('TRUE OR FALSE', moment().isAfter(moment(item.setup.dueDate.actual)));
        if (moment().isAfter(moment(item.setup.dueDate.actual))) {
          if (item.status === 'Incomplete') {
            console.log('ITEM3', item);
            overdue.push(item);
          }
        }
      });
      deferred.resolve(overdue);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },
  overdueTasks: function overdueTasks(req, res) {
    console.log("Made it to overdue tasks!");
    var deferred = Q.defer();
    ProjectTask.find().exec().then(function (tasks) {
      console.log('TASKS', tasks);
      var overdue = [];
      tasks.map(function (item) {
        console.log('ITEM1', moment(item.date.deadline));
        console.log('ITEM2', moment());
        console.log('TRUE OR FALSE', moment().isAfter(moment(item.date.deadline)));
        if (moment().isAfter(moment(item.date.deadline))) {
          console.log('ITEM3', item);
          overdue.push(item);
        }
      });
      deferred.resolve(overdue);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },
  projectsDueThisWeek: function projectsDueThisWeek(req, res) {
    console.log("Made it to projectsDueThisWeek");
    var deferred = Q.defer();
    Project.find().exec().then(function (projects) {
      console.log('PROJECTS', projects);
      var week = [];
      projects.map(function (item) {
        console.log("WEEK", moment(item.setup.dueDate.actual).week());
        console.log("CURRENT WEEK", moment().week());
        if (moment().week() === moment(item.setup.dueDate.actual).week()) {
          console.log('ITEM', item);
          week.push(item);
        }
      });
      deferred.resolve(week);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },
  projectsDueThisMonth: function projectsDueThisMonth(req, res) {
    console.log("Made it to projectsDueThisMonth");
    var deferred = Q.defer();
    Project.find().exec().then(function (projects) {
      console.log('PROJECTS', projects);
      var month = [];
      projects.map(function (item) {
        console.log("MONTH", moment(item.setup.dueDate.actual).month());
        console.log("CURRENT MONTH", moment().month());
        if (moment().month() === moment(item.setup.dueDate.actual).month()) {
          console.log('ITEM', item);
          month.push(item);
        }
      });
      deferred.resolve(month);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  },
  projectsDueToday: function projectsDueToday(req, res) {
    console.log("Made it to projectsDueToday");
    var deferred = Q.defer();
    Project.find().exec().then(function (projects) {
      console.log('PROJECTS', projects);
      var today = [];
      projects.map(function (item) {
        console.log("DUE DATE", moment(item.setup.dueDate.actual).dayOfYear());
        console.log("TODAY", moment().dayOfYear());
        if (moment(item.setup.dueDate.actual).dayOfYear() === moment().dayOfYear()) {
          console.log('ITEM', item);
          today.push(item);
        }
      });
      console.log("ARRAY", today);
      deferred.resolve(today);
    }).catch(function (err) {
      return res.status(500).end();
    });
    return deferred.promise;
  }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZlcl9hc3NldHMvY29udHJvbGxlcnMvc2xhY2tCb3RIZWxwZXJzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ3JDLElBQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBQ2xELElBQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0FBQ2hELElBQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0FBQ3RELElBQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBQ2xELElBQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0FBQ2hELElBQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0FBQ3hELElBQU0sQ0FBQyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUN2QixJQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDakMsSUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLCtCQUErQixDQUFDLENBQUM7QUFDekQsSUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLDRCQUE0QixDQUFDLENBQUM7O0FBRTFELE1BQU0sQ0FBQyxPQUFPLEdBQUc7Ozs7QUFJYixZQUFVLEVBQUUsb0JBQVMsS0FBSyxFQUFDO0FBQ3pCLFFBQUksUUFBUSxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztBQUN6QixXQUFPLENBQUMsR0FBRyxDQUFDLDhCQUE4QixDQUFDLENBQUM7QUFDNUMsUUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO0FBQ25CLFNBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRyxFQUFDO0FBQ3JDLGFBQU8sQ0FBQyxHQUFH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SSxLQUFLLEdBQUcsRUFBRSxDQUFDO0FBQ2YsY0FBUSxDQUFDLEdBQUcsQ0FBQyxVQUFDLElBQUksRUFBSztBQUNuQixlQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQztBQUN2RSxlQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFBO0FBQzFDLFlBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFNBQVMsRUFBRSxLQUFLLE1BQU0sRUFBRSxDQUFDLFNBQVMsRUFBRSxFQUFFO0FBQ3hFLGlCQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztBQUMxQixlQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3BCO09BQ0osQ0FBQyxDQUFDO0FBQ0gsYUFBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUE7QUFDM0IsY0FBUSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUMzQixDQUFDLENBQ0QsS0FBSyxDQUFDLFVBQUMsR0FBRyxFQUFLO0FBQ1osYUFBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO0tBQ2hDLENBQUMsQ0FBQztBQUNILFdBQU8sUUFBUSxDQUFDLE9BQU8sQ0FBQztHQUMzQjtDQUlKLENBQUMiLCJmaWxlIjoic2VydmVyX2Fzc2V0cy9jb250cm9sbGVycy9zbGFja0JvdEhlbHBlcnMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyk7XG5jb25zdCBQb3NpdGlvbiA9IHJlcXVpcmUoJy4uL21vZGVscy9Qb3NpdGlvbi5qcycpO1xuY29uc3QgQ29tcGFueSA9IHJlcXVpcmUoJy4uL21vZGVscy9Db21wYW55LmpzJyk7XG5jb25zdCBEZXBhcnRtZW50ID0gcmVxdWlyZSgnLi4vbW9kZWxzL0RlcGFydG1lbnQuanMnKTtcbmNvbnN0IEVtcGxveWVlID0gcmVxdWlyZSgnLi4vbW9kZWxzL0VtcGxveWVlLmpzJyk7XG5jb25zdCBQcm9qZWN0ID0gcmVxdWlyZSgnLi4vbW9kZWxzL1Byb2plY3QuanMnKTtcbmNvbnN0IFByb2plY3RUYXNrID0gcmVxdWlyZSgnLi4vbW9kZWxzL1Byb2plY3RUYXNrLmpzJyk7XG5jb25zdCBRID0gcmVxdWlyZSgncScpO1xuY29uc3QgbW9tZW50ID0gcmVxdWlyZSgnbW9tZW50Jyk7XG5jb25zdCBoZWxwZXJzID0gcmVxdWlyZSgnLi4vY29udHJvbGxlcnMvcHJvamVjdEhlbHBlcnMnKTtcbmNvbnN0IHByb2plY3RDdHJsID0gcmVxdWlyZSgnLi4vY29udHJvbGxlcnMvcHJvamVjdEN0cmwnKTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG5cbiAgLyoqKioqKioqKioqKioqIEFSUkFZUyAqKioqKioqKioqKioqKi9cblxuICAgIGFycmF5TWFrZXI6IGZ1bmN0aW9uKGFycmF5KXtcbiAgICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcbiAgICAgIGNvbnNvbGUubG9nKFwiSSdtIHRyeWluZyB0byBtYWtlIGFuIGFycmF5IVwiKTtcbiAgICAgIHZhciBtYWRlQXJyYXkgPSBbXTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpICsrKXtcbiAgICAgICAgY29uc29sZS5sb2coXCJIZXJlJ3MgdGhlIG5hbWUgSSdtIGxvb2tpbmcgYXQuLi4uXCIsIGFycmF5W2ldLm5hbWUpO1xuICAgICAgICBtYWRlQXJyYXkucHVzaChhcnJheVtpXS5uYW1lKTtcbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKFwiSGVyZSdzIHRoZSBmdWxsIGFycmF5IEkgbWFkZSBhbmQgYW0gdHJ5aW5nIHRvIHJldHVyblwiLCBtYWRlQXJyYXkpO1xuICAgICAgZGVmZXJyZWQucmVzb2x2ZShtYWRlQXJyYXkpO1xuICAgICAgY29uc29sZS5sb2coXCJUaGlzIGlzIHRoZSBkZWZlcnJlZCBwcm9taXNlXCIsIGRlZmVycmVkLnByb21pc2UpO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcblxuICAgIGFycmF5TWFrZXJFbXBsb3llZU5hbWU6IGZ1bmN0aW9uKGFycmF5KXtcbiAgICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcbiAgICAgIGNvbnNvbGUubG9nKFwiSSdtIHRyeWluZyB0byBtYWtlIGFuIGFycmF5IVwiLGFycmF5KTtcbiAgICAgIHZhciBtYWRlQXJyYXkgPSBbXTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpICsrKXtcbiAgICAgICAgY29uc29sZS5sb2coXCJIZXJlJ3MgdGhlIG5hbWUgSSdtIGxvb2tpbmcgYXQuLi4uXCIsIGFycmF5W2ldLmlkZW50aWZpY2F0aW9uLm5hbWUuZnVsbE5hbWUpO1xuICAgICAgICBtYWRlQXJyYXkucHVzaChhcnJheVtpXS5pZGVudGlmaWNhdGlvbi5uYW1lLmZ1bGxOYW1lKTtcbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKFwiSGVyZSdzIHRoZSBmdWxsIGFycmF5IEkgbWFkZSBhbmQgYW0gdHJ5aW5nIHRvIHJldHVyblwiLCBtYWRlQXJyYXkpO1xuICAgICAgZGVmZXJyZWQucmVzb2x2ZShtYWRlQXJyYXkpO1xuICAgICAgY29uc29sZS5sb2coXCJUaGlzIGlzIHRoZSBkZWZlcnJlZCBwcm9taXNlXCIsIGRlZmVycmVkLnByb21pc2UpO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcblxuLyoqKioqKioqKioqKioqIEFUVEFDSE1FTlRTICoqKioqKioqKioqKioqL1xuXG4gICAgYXR0YWNobWVudE1ha2VyOiBmdW5jdGlvbihhcnJheSxhdHRhY2htZW50VGl0bGUpe1xuICAgICAgY29uc29sZS5sb2coXCJIZXJlJ3MgdGhlIGFycmF5IHRvIGJlIHR1cm5lZCBpbnRvIGFuIGF0dGFjaGVtZW50XCIsIGFycmF5LCBhdHRhY2htZW50VGl0bGUpO1xuICAgICAgdmFyIGRlZmVycmVkID0gUS5kZWZlcigpO1xuICAgICAgY29uc29sZS5sb2coXCJJJ20gdHJ5aW5nIHRvIG1ha2UgYSBuaWNlIGF0dGFjaG1lbnQgZm9yIHlvdS4uLi5cIik7XG4gICAgICB2YXIgYXR0YWNobWVudCA9IHtcbiAgICAgICAgdGl0bGU6IGF0dGFjaG1lbnRUaXRsZSxcbiAgICAgICAgY29sb3I6ICcjN0ZFRkJEJyxcbiAgICAgICAgZmllbGRzOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGZvcih2YXIgaiA9IDA7IGogPCBhcnJheS5sZW5ndGg7IGogKyspe1xuICAgICAgICBhdHRhY2htZW50LmZpZWxkcy5wdXNoKHtcbiAgICAgICAgICBsYWJlbDogJ0ZpZWxkJyxcbiAgICAgICAgICB2YWx1ZTogYXJyYXlbal0sXG4gICAgICAgICAgc2hvcnQ6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZyhhdHRhY2htZW50KTtcbiAgICAgIGRlZmVycmVkLnJlc29sdmUoYXR0YWNobWVudCk7XG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9LFxuXG4gICAgaGVscEF0dGFjaG1lbnQ6IGZ1bmN0aW9uKGFycmF5LGF0dGFjaG1lbnRUaXRsZSl7XG4gICAgICBjb25zb2xlLmxvZyhcIkhlcmUncyB0aGUgYXJyYXkgdG8gYmUgdHVybmVkIGludG8gYW4gYXR0YWNoZW1lbnRcIiwgYXJyYXksIGF0dGFjaG1lbnRUaXRsZSk7XG4gICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgICBjb25zb2xlLmxvZyhcIkknbSB0cnlpbmcgdG8gbWFrZSBhIG5pY2UgYXR0YWNobWVudCBmb3IgeW91Li4uLlwiKTtcbiAgICAgIHZhciBhdHRhY2htZW50ID0ge1xuICAgICAgICB0aXRsZTogYXR0YWNobWVudFRpdGxlLFxuICAgICAgICBjb2xvcjogJyM3RkVGQkQnLFxuICAgICAgICBmaWVsZHM6IFt7XG4gICAgICAgICAgbGFiZWw6ICdGaWVsZCcsXG4gICAgICAgICAgdGl0bGU6ICcgJyxcbiAgICAgICAgICB2YWx1ZTogXCJIaS5cXG4gSSBkaWRuJ3QgdW5kZXJzdGFuZCB3aGF0IHlvdSB3YW50LiBcXG5CdXQgZG9uJ3Qgd29ycnkuLi4gSSdtIGhlcmUgdG8gaGVscC4gXFxuQmVmb3JlIHlvdSBwYW5pYyBjaGVjayBvdXQgdGhpcyBsaXN0IG9mIGNvbW1hbmRzIHRvIGdldCB0aGUgaW5mbyB5b3UgbmVlZC4gQmVjYXVzZSBJJ20gYXJ0aWZpY2FsbHkgaW50ZWxsaWdlbnQsIGlmIHlvdSB0eXBlIGFueXRoaW5nIGNsb3NlIHRvIHRoZSBjb21tYW5kcyBiZWxvdyBJJ2xsIHByb2JhYmx5IGdpdmUgeW91IHdoYXQgeW91ciBsb29raW5nIGZvci4gSWYgbm90LCBqdXN0IHR5cGUgdGhlIGNsb3Nlc3QgY29tbWFuZCBleGFjdGx5LiBPdmVyIHRpbWUgSSdsbCBnZXQgYmV0dGVyIGFuZCBiZXR0ZXIgYXQgdW5kZXJzdGFuZGluZyB5b3VyIGludGVudCwgc28gZ2V0IHRvIHdvcmshXFxuXCIsXG4gICAgICAgICAgc2hvcnQ6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbGFiZWw6ICdGaWVsZCcsXG4gICAgICAgICAgdmFsdWU6ICcgJyxcbiAgICAgICAgICBzaG9ydDogdHJ1ZSxcbiAgICAgICAgfSx7XG4gICAgICAgICAgbGFiZWw6ICdGaWVsZCcsXG4gICAgICAgICAgdmFsdWU6ICcgJyxcbiAgICAgICAgICBzaG9ydDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGxhYmVsOiAnRmllbGQnLFxuICAgICAgICAgIHZhbHVlOiAnKkNvbW1hbmQqJyxcbiAgICAgICAgICBzaG9ydDogdHJ1ZSxcbiAgICAgICAgfSx7XG4gICAgICAgICAgbGFiZWw6ICdGaWVsZCcsXG4gICAgICAgICAgdmFsdWU6ICcqRGVzY3JpcHRpb24qJyxcbiAgICAgICAgICBzaG9ydDogdHJ1ZSxcbiAgICAgICAgfV0sXG4gICAgICAgIG1ya2R3bl9pbjogWydmaWVsZHMnXVxuICAgICAgfTtcblxuICAgICAgZm9yKHZhciBqID0gMDsgaiA8IGFycmF5Lmxlbmd0aDsgaiArKyl7XG4gICAgICAgIGF0dGFjaG1lbnQuZmllbGRzLnB1c2goe1xuICAgICAgICAgIGxhYmVsOiAnRmllbGQnLFxuICAgICAgICAgIHZhbHVlOiBhcnJheVtqXSxcbiAgICAgICAgICBzaG9ydDogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKGF0dGFjaG1lbnQpO1xuICAgICAgZGVmZXJyZWQucmVzb2x2ZShhdHRhY2htZW50KTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH0sXG5cbiAgICBwcm9qZWN0c0F0dGFjaG1lbnQ6IGZ1bmN0aW9uKGFycmF5LGF0dGFjaG1lbnRUaXRsZSl7XG4gICAgICBjb25zb2xlLmxvZyhcIkhlcmUncyB0aGUgYXJyYXkgdG8gYmUgdHVybmVkIGludG8gYW4gYXR0YWNobWVudFwiLCBhcnJheSwgYXR0YWNobWVudFRpdGxlKTtcbiAgICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcbiAgICAgIGNvbnNvbGUubG9nKFwiSSdtIHRyeWluZyB0byBtYWtlIGEgbmljZSBhdHRhY2htZW50IGZvciB5b3UuLi4uXCIpO1xuICAgICAgdmFyIGF0dGFjaG1lbnQgPSB7XG4gICAgICAgIHRpdGxlOiBhdHRhY2htZW50VGl0bGUsXG4gICAgICAgIGNvbG9yOiAnIzdGRUZCRCcsXG4gICAgICAgIGZpZWxkczogW10sXG4gICAgICAgIG1ya2R3bl9pbjogWydmaWVsZHMnXVxuICAgICAgfTtcblxuICAgICAgZm9yKHZhciBqID0gMDsgaiA8IGFycmF5Lmxlbmd0aDsgaiArKyl7XG4gICAgICAgICAgY29uc29sZS5sb2coYXJyYXlbal0pXG4gICAgICAgIGF0dGFjaG1lbnQuZmllbGRzLnB1c2goe1xuICAgICAgICAgIGxhYmVsOiAnRmllbGQnLFxuICAgICAgICAgIHZhbHVlOiBcIl8jXCIgKyBhcnJheVtqXS5mcmllbmRseUlkICsgXCJfOiAqXCIgKyBhcnJheVtqXS5uYW1lICsgXCIqIC0gXCIgKyBhcnJheVtqXS5kZXNjcmlwdGlvbiArIFwiIC0gKiMgb2YgVGFza3MgKFwiICsgYXJyYXlbal0udGFza3MubGVuZ3RoICsgXCIpIC0gKkR1ZSA6ICpcIiArIG1vbWVudChhcnJheVtqXS5zZXR1cC5kdWVEYXRlLmFjdHVhbCkuZm9ybWF0KCdkZGRkLCBNTU1NIERvJykgKyBcIiAtICpTdGF0dXM6ICpcIiArIGFycmF5W2pdLnN0YXR1cyxcbiAgICAgICAgICBzaG9ydDogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBkZWZlcnJlZC5yZXNvbHZlKGF0dGFjaG1lbnQpO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcblxuICAgIHRhc2tBdHRhY2htZW50OiBmdW5jdGlvbihhcnJheSxhdHRhY2htZW50VGl0bGUpe1xuICAgICAgY29uc29sZS5sb2coXCJIZXJlJ3MgdGhlIGFycmF5IHRvIGJlIHR1cm5lZCBpbnRvIGFuIGF0dGFjaG1lbnRcIiwgYXJyYXksIGF0dGFjaG1lbnRUaXRsZSk7XG4gICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgICBjb25zb2xlLmxvZyhcIkknbSB0cnlpbmcgdG8gbWFrZSBhIG5pY2UgYXR0YWNobWVudCBmb3IgeW91Li4uLlwiKTtcbiAgICAgIHZhciBhdHRhY2htZW50ID0ge1xuICAgICAgICB0aXRsZTogYXR0YWNobWVudFRpdGxlLFxuICAgICAgICBjb2xvcjogJyM3RkVGQkQnLFxuICAgICAgICBmaWVsZHM6IFtdLFxuICAgICAgICBtcmtkd25faW46IFsnZmllbGRzJ11cbiAgICAgIH07XG5cbiAgICAgIGZvcih2YXIgaiA9IDA7IGogPCBhcnJheS5sZW5ndGg7IGogKyspe1xuICAgICAgICBhdHRhY2htZW50LmZpZWxkcy5wdXNoKHtcbiAgICAgICAgICBsYWJlbDogJ0ZpZWxkJyxcbiAgICAgICAgICB2YWx1ZTogXCJfI1wiICsgYXJyYXlbal0uZnJpZW5kbHlJZCArIFwiXzogKlwiICsgYXJyYXlbal0ubmFtZSArICBcIiAtICpTdGF0dXM6ICpcIiArIGFycmF5W2pdLnN0YXR1cyxcbiAgICAgICAgICBzaG9ydDogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBkZWZlcnJlZC5yZXNvbHZlKGF0dGFjaG1lbnQpO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcblxuICAgIC8qKioqKioqKioqKioqKiBGT1JNQVRUSU5HICoqKioqKioqKioqKioqL1xuXG4gICAgaGFzaFN0cmlwcGVyOiBmdW5jdGlvbihpZCl7XG4gICAgICBjb25zb2xlLmxvZyhcIkhlcmUncyB0aGUgaWQgSSdtIHRyeWluZyB0byBmaXhcIiwgaWQpO1xuICAgICAgdmFyIGRlZmVycmVkID0gUS5kZWZlcigpO1xuICAgICAgaWYoaWQuY2hhckF0KDApICE9PSBcIiNcIikge1xuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGlkKTtcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgY2xlYW5JZCA9IGlkLnNwbGl0KCcjJyk7XG4gICAgICAgIGRlZmVycmVkLnJlc29sdmUoY2xlYW5JZFsxXSk7XG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgfVxuICAgIH0sXG5cblxuICAgIC8qKioqKioqKioqKioqKiBRVUVSSUVTIC0gREVQQVJUTUVOVFMgICoqKioqKioqKioqKioqL1xuICAgIGFsbERlcGFydG1lbnRzOiBmdW5jdGlvbihyZXEsIHJlcykge1xuICAgICAgdmFyIGRlZmVycmVkID0gUS5kZWZlcigpO1xuICAgICAgRGVwYXJ0bWVudC5maW5kKCkuZXhlYygpXG4gICAgICAgIC50aGVuKChkZXBhcnRtZW50cykgPT4ge1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGVwYXJ0bWVudHMpO1xuICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmVuZCgpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9LFxuXG4gICAgLyoqKioqKioqKioqKioqIFFVRVJJRVMgLSBFTVBMT1lFRVMgICoqKioqKioqKioqKioqL1xuICAgIGFsbEVtcGxveWVlczogZnVuY3Rpb24ocmVxLCByZXMpIHtcbiAgICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcbiAgICAgIEVtcGxveWVlLmZpbmQoKS5leGVjKClcbiAgICAgICAgLnRoZW4oKGVtcGxveWVlcykgPT4ge1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZW1wbG95ZWVzKTtcbiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5lbmQoKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcblxuICAgIC8qKioqKioqKioqKioqKiBRVUVSSUVTIC0gUE9TSVRJT05TICAqKioqKioqKioqKioqKi9cbiAgICBhbGxQb3NpdGlvbnM6IGZ1bmN0aW9uKHJlcSwgcmVzKSB7XG4gICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgICBQb3NpdGlvbi5maW5kKCkuZXhlYygpXG4gICAgICAgIC50aGVuKChwb3NpdGlvbnMpID0+IHtcbiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHBvc2l0aW9ucyk7XG4gICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuZW5kKCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH0sXG5cblxuXG4gICAgLyoqKioqKioqKioqKioqIFFVRVJJRVMgLSBQUk9KRUNUUyAgKioqKioqKioqKioqKiovXG4gICAgYWxsUHJvamVjdHM6IGZ1bmN0aW9uKHJlcSwgcmVzKSB7XG4gICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgICBQcm9qZWN0LmZpbmQoKS5leGVjKClcbiAgICAgICAgLnRoZW4oKHByb2plY3RzKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJIZXJlJ3MgdGhlIHByb2plY3RzIEkgZm91bmQuLi5cIixwcm9qZWN0cyk7XG4gICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShwcm9qZWN0cyk7XG4gICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuZW5kKCk7XG4gICAgICB9KTtcbiAgICAgIGNvbnNvbGUubG9nKGRlZmVycmVkLnByb21pc2UpO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcblxuICAgIGFsbEluY29tcGxldGVQcm9qZWN0czogZnVuY3Rpb24ocmVxLCByZXMpIHtcbiAgICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcbiAgICAgIFByb2plY3QuZmluZCgpLmV4ZWMoKVxuICAgICAgICAudGhlbigocHJvamVjdHMpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIkhlcmUncyB0aGUgaW5jb21wbGV0ZSBwcm9qZWN0cyBJIGZvdW5kLi4uXCIsIHByb2plY3RzKTtcbiAgICAgICAgICBjb25zdCBpbmNvbXBsZXRlUHJvamVjdHMgPSBbXTtcbiAgICAgICAgICBwcm9qZWN0cy5tYXAoKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJVEVNXCIsIGl0ZW0pO1xuICAgICAgICAgICAgICBpZiAoaXRlbS5zdGF0dXMgPT09ICdJbmNvbXBsZXRlJykge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0lOQ09NUExFVEUgUFJPSkVDVFMnLCBpdGVtKTtcbiAgICAgICAgICAgICAgICAgIGluY29tcGxldGVQcm9qZWN0cy5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShpbmNvbXBsZXRlUHJvamVjdHMpO1xuICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmVuZCgpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9LFxuXG4gICAgYWxsQ29tcGxldGVQcm9qZWN0czogZnVuY3Rpb24ocmVxLCByZXMpIHtcbiAgICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcbiAgICAgIFByb2plY3QuZmluZCgpLmV4ZWMoKVxuICAgICAgICAudGhlbigocHJvamVjdHMpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIkhlcmUncyB0aGUgQ29tcGxldGUgcHJvamVjdHMgSSBmb3VuZC4uLlwiLCBwcm9qZWN0cyk7XG4gICAgICAgICAgY29uc3QgY29tcGxldGVQcm9qZWN0cyA9IFtdO1xuICAgICAgICAgIHByb2plY3RzLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIklURU1cIiwgaXRlbSk7XG4gICAgICAgICAgICAgIGlmIChpdGVtLnN0YXR1cyA9PT0gJ0NvbXBsZXRlJykge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0NPTVBMRVRFIFBST0pFQ1RTJywgaXRlbSk7XG4gICAgICAgICAgICAgICAgICBjb21wbGV0ZVByb2plY3RzLnB1c2goaXRlbSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGNvbXBsZXRlUHJvamVjdHMpO1xuICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmVuZCgpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9LFxuXG4gICAgLyoqKioqKioqKioqKioqIFFVRVJJRVMgLSBQUk9KRUNUIFRBU0tTICAqKioqKioqKioqKioqKi9cbiAgICBhbGxQcm9qZWN0VGFza3M6IGZ1bmN0aW9uKHJlcSxyZXMpe1xuICAgICAgY29uc29sZS5sb2coXCJNYWRlIGl0IHRvIGFsbCBwcm9qZWN0IHRhc2tzIVwiKTtcbiAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgUHJvamVjdFRhc2suZmluZCgpLmV4ZWMoKS50aGVuKChyZXN1bHRzKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhcIlRoaXMgaXMgd2hhdCBJIGZvdW5kIGZvciBhbGwgdGhlIHRhc2tzXCIsIHJlc3VsdHMpO1xuICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXN1bHRzKTtcbiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5lbmQoKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcblxuICAgIGFsbEluY29tcGxldGVUYXNrczogZnVuY3Rpb24ocmVxLHJlcyl7XG4gICAgICBjb25zb2xlLmxvZyhcIk1hZGUgaXQgdG8gYWxsIGluY29tcGxldGUgdGFza3MhXCIpO1xuICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcbiAgICBQcm9qZWN0VGFzay5maW5kKCkuZXhlYygpLnRoZW4oKHJlc3VsdHMpID0+IHtcbiAgICAgICAgY29uc3QgaW5jb21wbGV0ZVRhc2tzID0gW107XG4gICAgICAgIHJlc3VsdHMubWFwKChpdGVtKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRBU0tcIiwgaXRlbSk7XG4gICAgICAgICAgICBpZiAoaXRlbS5zdGF0dXMgPT09ICdJbmNvbXBsZXRlJykge1xuICAgICAgICAgICAgICAgIGluY29tcGxldGVUYXNrcy5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIGRlZmVycmVkLnJlc29sdmUoaW5jb21wbGV0ZVRhc2tzKTtcbiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5lbmQoKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcblxuICAgIHRhc2tzSW5Qcm9qZWN0OiBmdW5jdGlvbihpZCl7XG4gICAgICBjb25zb2xlLmxvZyhcIkhlcmUncyB0aGUgaWQgSSdtIGxvb2tpbmcgZm9yXCIsIGlkKTtcbiAgICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcbiAgICAgIFByb2plY3QuZmluZCh7XCJmcmllbmRseUlkXCI6aWR9KVxuICAgICAgLnBvcHVsYXRlKCd0YXNrcycpXG4gICAgICAuZXhlYygpXG4gICAgICAudGhlbigocmVzdWx0KT0+e1xuICAgICAgICBjb25zb2xlLmxvZyhcImRpZCBpIGZpbmQgYSBwcm9qZWN0P1wiLCByZXN1bHQpO1xuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICB9KS5jYXRjaCgoZXJyKT0+IHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5lbmQoKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcbiAgICBcbiAgICB0YXNrQ29tcGxldGUoaWQpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiSGVyZSdzIHRoZSBpZCBJJ20gbG9va2luZyBmb3JcIiwgaWQpO1xuICAgICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgICAgIFByb2plY3RUYXNrLmZpbmRPbmVBbmRVcGRhdGUoe1wiZnJpZW5kbHlJZFwiOiBpZH0sIHtzdGF0dXM6ICdDb21wbGV0ZSd9LCB7bmV3OiB0cnVlfSlcbiAgICAgICAgLmV4ZWMoKVxuICAgICAgICAudGhlbigobmV3VGFzaykgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJSRVNVTFRcIiwgbmV3VGFzayk7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKG5ld1Rhc2spO1xuICAgICAgICB9KVxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9LFxuICAgIFxuICAgIHN0YXR1c0NoZWNrKGlkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiSURcIiwgaWQpO1xuICAgICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgICAgIFByb2plY3RUYXNrLmZpbmQoe1wiZnJpZW5kbHlJZFwiOiBpZH0pXG4gICAgICAgIC5leGVjKClcbiAgICAgICAgLnRoZW4oKHRhc2spID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUQVNLJywgdGFzayk7XG4gICAgICAgICAgICAgIGlmICh0YXNrWzBdLnN0YXR1cyA9PT0gJ0NvbXBsZXRlJyl7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShmYWxzZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUodGFzayk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICB9KVxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9LFxuICAgIFxuICAgIHRhc2tDb21wbGV0ZUNvdW50KHByb2plY3RJZCkge1xuICAgICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgICAgIHZhciBvbGRQcm9qZWN0O1xuICAgICAgICBQcm9qZWN0LmZpbmQoeydfaWQnOiBwcm9qZWN0SWR9KVxuICAgICAgICAuZXhlYygpXG4gICAgICAgIC50aGVuKChwcm9qZWN0KSA9PiB7XG4gICAgICAgICAgICBwcm9qZWN0WzBdLnRhc2tzQ29tcGxldGVkKys7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIiMgVEFTS1MgQ09NUExFVEVEXCIsIHByb2plY3RbMF0udGFza3NDb21wbGV0ZWQpO1xuICAgICAgICAgICAgaWYgKHByb2plY3RbMF0udGFza3NDb21wbGV0ZWQgPT09IHByb2plY3RbMF0udGFza3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcHJvamVjdFswXS5zdGF0dXMgPSAnQ29tcGxldGUnO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSVMgUFJPSkVDVCBDT01QTEVURT9cIiwgcHJvamVjdFswXS5zdGF0dXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc29sZS5sb2coJ0lTIFRISVMgQSBQUk9NSVNFPycsIHByb2plY3RbMF0uc2F2ZSgpKTtcbiAgICAgICAgICAgIHJldHVybiBwcm9qZWN0WzBdLnNhdmUoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oKHByb2plY3QpID0+IHtcbiAgICAgICAgICAgIGlmIChwcm9qZWN0LnN0YXR1cyA9PT0gJ0NvbXBsZXRlJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBwcm9qZWN0Q3RybC5uZXdQcm9qZWN0KHByb2plY3Quc2V0dXAuYXNzb2NpYXRlZFRlbXBsYXRlKTsgICBcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAudGhlbigobmV3UHJvamVjdCkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0RJRCBJVCBXT1JLPycsIG5ld1Byb2plY3QpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqKioqKioqKioqKioqIFFVRVJJRVMgLSBEVUUgREFURVMgICoqKioqKioqKioqKioqL1xuXG4gICAgb3ZlcmR1ZVByb2plY3RzKHJlcSwgcmVzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiTWFkZSBpdCB0byBvdmVyZHVlIHByb2plY3RzIVwiKTtcbiAgICAgICAgdmFyIGRlZmVycmVkID0gUS5kZWZlcigpO1xuICAgICAgICBQcm9qZWN0LmZpbmQoKS5leGVjKClcbiAgICAgICAgLnRoZW4oKHByb2plY3RzKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnUFJPSkVDVFMnLCBwcm9qZWN0cyk7XG4gICAgICAgICAgICB2YXIgb3ZlcmR1ZSA9IFtdO1xuICAgICAgICAgICAgcHJvamVjdHMubWFwKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0lURU0xJywgaXRlbS5zZXR1cC5kdWVEYXRlLmFjdHVhbCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0lURU0yJywgbW9tZW50KCkpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUUlVFIE9SIEZBTFNFJywgbW9tZW50KCkuaXNBZnRlcihtb21lbnQoaXRlbS5zZXR1cC5kdWVEYXRlLmFjdHVhbCkpKTtcbiAgICAgICAgICAgICAgICBpZiAobW9tZW50KCkuaXNBZnRlcihtb21lbnQoaXRlbS5zZXR1cC5kdWVEYXRlLmFjdHVhbCkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnN0YXR1cyA9PT0gJ0luY29tcGxldGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnSVRFTTMnLCBpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJkdWUucHVzaChpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShvdmVyZHVlKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuZW5kKCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9LFxuXG4gICAgb3ZlcmR1ZVRhc2tzKHJlcSwgcmVzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiTWFkZSBpdCB0byBvdmVyZHVlIHRhc2tzIVwiKTtcbiAgICAgICAgdmFyIGRlZmVycmVkID0gUS5kZWZlcigpO1xuICAgICAgICBQcm9qZWN0VGFzay5maW5kKCkuZXhlYygpXG4gICAgICAgIC50aGVuKCh0YXNrcykgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1RBU0tTJywgdGFza3MpO1xuICAgICAgICAgICAgdmFyIG92ZXJkdWUgPSBbXTtcbiAgICAgICAgICAgIHRhc2tzLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJVEVNMScsIG1vbWVudChpdGVtLmRhdGUuZGVhZGxpbmUpKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnSVRFTTInLCBtb21lbnQoKSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1RSVUUgT1IgRkFMU0UnLCBtb21lbnQoKS5pc0FmdGVyKG1vbWVudChpdGVtLmRhdGUuZGVhZGxpbmUpKSk7XG4gICAgICAgICAgICAgICAgaWYgKG1vbWVudCgpLmlzQWZ0ZXIobW9tZW50KGl0ZW0uZGF0ZS5kZWFkbGluZSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJVEVNMycsIGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBvdmVyZHVlLnB1c2goaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKG92ZXJkdWUpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5lbmQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH0sXG5cbiAgICBwcm9qZWN0c0R1ZVRoaXNXZWVrKHJlcSwgcmVzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiTWFkZSBpdCB0byBwcm9qZWN0c0R1ZVRoaXNXZWVrXCIpO1xuICAgICAgICB2YXIgZGVmZXJyZWQgPSBRLmRlZmVyKCk7XG4gICAgICAgIFByb2plY3QuZmluZCgpLmV4ZWMoKVxuICAgICAgICAudGhlbigocHJvamVjdHMpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQUk9KRUNUUycsIHByb2plY3RzKTtcbiAgICAgICAgICAgIHZhciB3ZWVrID0gW107XG4gICAgICAgICAgICBwcm9qZWN0cy5tYXAoKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIldFRUtcIiwgbW9tZW50KGl0ZW0uc2V0dXAuZHVlRGF0ZS5hY3R1YWwpLndlZWsoKSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJDVVJSRU5UIFdFRUtcIiwgbW9tZW50KCkud2VlaygpKTtcbiAgICAgICAgICAgICAgICBpZiAobW9tZW50KCkud2VlaygpID09PSBtb21lbnQoaXRlbS5zZXR1cC5kdWVEYXRlLmFjdHVhbCkud2VlaygpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJVEVNJywgaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIHdlZWsucHVzaChpdGVtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUod2Vlayk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmVuZCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcblxuICAgIHByb2plY3RzRHVlVGhpc01vbnRoKHJlcSwgcmVzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiTWFkZSBpdCB0byBwcm9qZWN0c0R1ZVRoaXNNb250aFwiKTtcbiAgICAgICAgdmFyIGRlZmVycmVkID0gUS5kZWZlcigpO1xuICAgICAgICBQcm9qZWN0LmZpbmQoKS5leGVjKClcbiAgICAgICAgLnRoZW4oKHByb2plY3RzKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnUFJPSkVDVFMnLCBwcm9qZWN0cylcbiAgICAgICAgICAgIHZhciBtb250aCA9IFtdO1xuICAgICAgICAgICAgcHJvamVjdHMubWFwKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJNT05USFwiLCBtb21lbnQoaXRlbS5zZXR1cC5kdWVEYXRlLmFjdHVhbCkubW9udGgoKSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJDVVJSRU5UIE1PTlRIXCIsIG1vbWVudCgpLm1vbnRoKCkpO1xuICAgICAgICAgICAgICAgIGlmIChtb21lbnQoKS5tb250aCgpID09PSBtb21lbnQoaXRlbS5zZXR1cC5kdWVEYXRlLmFjdHVhbCkubW9udGgoKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnSVRFTScsIGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBtb250aC5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShtb250aCk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmVuZCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcblxuICAgIHByb2plY3RzRHVlVG9kYXkocmVxLCByZXMpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJNYWRlIGl0IHRvIHByb2plY3RzRHVlVG9kYXlcIik7XG4gICAgICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcbiAgICAgICAgUHJvamVjdC5maW5kKCkuZXhlYygpXG4gICAgICAgIC50aGVuKChwcm9qZWN0cykgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1BST0pFQ1RTJywgcHJvamVjdHMpXG4gICAgICAgICAgICB2YXIgdG9kYXkgPSBbXTtcbiAgICAgICAgICAgIHByb2plY3RzLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRFVFIERBVEVcIiwgbW9tZW50KGl0ZW0uc2V0dXAuZHVlRGF0ZS5hY3R1YWwpLmRheU9mWWVhcigpKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRPREFZXCIsIG1vbWVudCgpLmRheU9mWWVhcigpKVxuICAgICAgICAgICAgICAgIGlmIChtb21lbnQoaXRlbS5zZXR1cC5kdWVEYXRlLmFjdHVhbCkuZGF5T2ZZZWFyKCkgPT09IG1vbWVudCgpLmRheU9mWWVhcigpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJVEVNJywgaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIHRvZGF5LnB1c2goaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkFSUkFZXCIsIHRvZGF5KVxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSh0b2RheSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmVuZCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcblxuXG5cbn07XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
