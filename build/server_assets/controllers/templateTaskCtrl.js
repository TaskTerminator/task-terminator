'use strict';

var mongoose = require('mongoose');
var TemplateTask = require('../models/TemplateTask.js');
var Template = require('../models/Template.js');
var moment = require('moment');
var time = require('../controllers/timeCtrl.js');

module.exports = {
  addTask: function addTask(req, res) {
    console.log(req.body);
    var newTemplateTask = new TemplateTask(req.body);
    Template.findOne({
      _id: req.params.templateid
    }).exec().then(function (result) {
      // console.log(result);
      result.tasks.push(newTemplateTask._id);
      result.save();
    });

    newTemplateTask.save().then(function (result) {
      return res.json(result);
    }).catch(function (err) {
      return res.status(500).end();
    });
  },
  getAllTasks: function getAllTasks(req, res) {
    TemplateTask.find().exec().then(function (result) {
      return res.json(result);
    }).catch(function (err) {
      return res.status(500).end();
    });
  },
  getTasks: function getTasks(req, res) {
    Template.findById({ _id: req.params.id }).exec().then(function (result) {
      return res.json(result.tasks);
    }).catch(function (err) {
      return res.status(500).end();
    });
  }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZlcl9hc3NldHMvY29udHJvbGxlcnMvdGVtcGxhdGVUYXNrQ3RybC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLElBQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUNyQyxJQUFNLFlBQVksR0FBRyxPQUFPLENBQUMsMkJBQTJCLENBQUMsQ0FBQztBQUMxRCxJQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUNsRCxJQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDakMsSUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLDRCQUE0QixDQUFDLENBQUM7O0FBRW5ELE1BQU0sQ0FBQyxPQUFPLEdBQUc7QUFDZixTQUFPLG1CQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUU7QUFDaEIsV0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDcEIsUUFBTSxlQUFlLEdBQUcsSUFBSSxZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ25ELFlBQVEsQ0FDTCxPQUFPLENBQUM7QUFDUCxTQUFHLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxVQUFVO0tBQzNCLENBQUMsQ0FDRCxJQUFJLEVBQUUsQ0FDTixJQUFJLENBQUMsVUFBUyxNQUFNLEVBQUU7O0FBRXJCLFlBQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUN2QyxZQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7S0FDZixDQUFDLENBQUM7O0FBRUgsbUJBQWUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBQyxNQUFNLEVBQUs7QUFDcEMsYUFBTyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQzNCLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBQyxHQUFHLEVBQUs7QUFDZCxhQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7S0FDaEMsQ0FBQyxDQUFDO0dBQ047QUFFRCxhQUFXLHVCQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUU7QUFDcEIsZ0JBQVksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBQyxNQUFNLEVBQUs7QUFDeEMsYUFBTyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQzNCLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBQyxHQUFHLEVBQUs7QUFDZCxhQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7S0FDaEMsQ0FBQyxDQUFDO0dBQ0o7QUFFRCxVQUFRLG9CQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUU7QUFDakIsWUFBUSxDQUFDLFFBQVEsQ0FBQyxFQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQUMsTUFBTSxFQUFLO0FBQzVELGFBQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7S0FDbkMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFDLEdBQUcsRUFBSztBQUNaLGFBQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztLQUNoQyxDQUFDLENBQUM7R0FDSjtDQUNKLENBQUMiLCJmaWxlIjoic2VydmVyX2Fzc2V0cy9jb250cm9sbGVycy90ZW1wbGF0ZVRhc2tDdHJsLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xuY29uc3QgVGVtcGxhdGVUYXNrID0gcmVxdWlyZSgnLi4vbW9kZWxzL1RlbXBsYXRlVGFzay5qcycpO1xuY29uc3QgVGVtcGxhdGUgPSByZXF1aXJlKCcuLi9tb2RlbHMvVGVtcGxhdGUuanMnKTtcbmNvbnN0IG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudCcpO1xuY29uc3QgdGltZSA9IHJlcXVpcmUoJy4uL2NvbnRyb2xsZXJzL3RpbWVDdHJsLmpzJyk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBhZGRUYXNrKHJlcSwgcmVzKSB7XG4gICAgY29uc29sZS5sb2cocmVxLmJvZHkpO1xuICAgICAgY29uc3QgbmV3VGVtcGxhdGVUYXNrID0gbmV3IFRlbXBsYXRlVGFzayhyZXEuYm9keSk7XG4gICAgICBUZW1wbGF0ZVxuICAgICAgICAuZmluZE9uZSh7XG4gICAgICAgICAgX2lkOiByZXEucGFyYW1zLnRlbXBsYXRlaWRcbiAgICAgICAgfSlcbiAgICAgICAgLmV4ZWMoKVxuICAgICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXN1bHQpO1xuICAgICAgICAgIHJlc3VsdC50YXNrcy5wdXNoKG5ld1RlbXBsYXRlVGFzay5faWQpO1xuICAgICAgICAgIHJlc3VsdC5zYXZlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIG5ld1RlbXBsYXRlVGFzay5zYXZlKCkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLmpzb24ocmVzdWx0KTtcbiAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5lbmQoKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGdldEFsbFRhc2tzKHJlcSwgcmVzKSB7XG4gICAgICBUZW1wbGF0ZVRhc2suZmluZCgpLmV4ZWMoKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICByZXR1cm4gcmVzLmpzb24ocmVzdWx0KTtcbiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmVuZCgpO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIGdldFRhc2tzKHJlcSwgcmVzKSB7XG4gICAgICBUZW1wbGF0ZS5maW5kQnlJZCh7X2lkOiByZXEucGFyYW1zLmlkfSkuZXhlYygpLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgIHJldHVybiByZXMuanNvbihyZXN1bHQudGFza3MpO1xuICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmVuZCgpO1xuICAgICAgfSk7XG4gICAgfVxufTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
